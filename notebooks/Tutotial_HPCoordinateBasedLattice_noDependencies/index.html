<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial: Protein Folding with Quantum Approximate Optimization Algorithm (QAOA) &mdash; Quantum Autumn School 2023  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script data-domain="enccs.github.io/qas2023" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="prev" title="Tutorial - Quantum support vector regression for disability insurance" href="../QF/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../" class="icon icon-home">
            Quantum Autumn School 2023
              <img src="../../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/">Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Day 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../qc-overview/">Physical Approaches to Quantum Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../digital-qc/">Introduction to Digital Quantum Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E1_qc-1/">Tutorial - Quantum programming I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E1_qc-2/">Tutorial - Quantum programming II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E1_qc-3/">Tutorial - Quantum programming III</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Day 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hpc-qc/">HPC-QC integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software-stack/">QC software stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hybrid-classical-quantum/">Hybrid Classical/Quantum Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro-to-helmi-qiskit/">Tutorial - Introduction to Helmi with qiskit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Qubit_Spectroscopy_Analysis/">Tutorial - Qubit Spectroscopy Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Notebook_maxcut_Qas2023/">Tutorial - Quantum Alternating Operator Ansatz</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Day 3</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../hybrid-quantum-chemistry/">Hybrid Algorithms - Use Cases for Quantum Chemistry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hybrid-finance/">Hybrid Algorithms - Use Cases for Quantum Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hybrid-life-science/">Hybrid Algorithms - Use Cases for Quantum Life Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E2_VQE-H2/">Tutorial - Quantum chemistry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Workshop-ADAPT/">Tutorial - Adaptive State Preparation Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QF/">Tutorial - Quantum support vector regression for disability insurance</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: Protein Folding with Quantum Approximate Optimization Algorithm (QAOA)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#protein-model">Protein model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quantum-approximate-optimization-algorithm-qaoa">Quantum Approximate Optimization Algorithm (QAOA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protein-instance-into-cost-hamiltonian">Protein instance into cost Hamiltonian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ground-state-of-the-cost-hamiltonian">Ground state of the cost Hamiltonian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#we-also-need-a-mixer-hamiltonian-for-our-qaoa">We also need a mixer Hamiltonian for our QAOA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pennylane-to-build-the-qaoa-circuit">Using Pennylane to build the QAOA circuit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#optimisation-of-the-circuit-parameters-with-a-gradient-descent">Optimisation of the circuit parameters with a gradient descent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#evaluation-of-optimisation-of-cirquit-parameters">Evaluation of optimisation of cirquit parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#here-follows-a-different-ways-to-get-a-better-success-probability">Here follows a different ways to get a better success probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-to-a-smarter-mixer-hamiltonian">Changing to a smarter mixer Hamiltonian</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimisation-of-the-circuit-parameters-with-grid-search">Optimisation of the circuit parameters with grid search</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#interpolate-parameters">Interpolate parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#optimisation-of-the-circuit-parameters-with-quantum-annealing-initialisation">Optimisation of the circuit parameters with quantum annealing initialisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jax-and-jit">JAX and JIT</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://enccs.se/lessons/">All ENCCS lessons</a></li>
<li class="toctree-l1"><a class="reference external" href="https://enccs.se/">About ENCCS</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Quantum Autumn School 2023</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial: Protein Folding with Quantum Approximate Optimization Algorithm (QAOA)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/qas2023/blob/main/content/notebooks/Tutotial_HPCoordinateBasedLattice_noDependencies.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-protein-folding-with-quantum-approximate-optimization-algorithm-qaoa">
<h1>Tutorial: Protein Folding with Quantum Approximate Optimization Algorithm (QAOA)<a class="headerlink" href="#tutorial-protein-folding-with-quantum-approximate-optimization-algorithm-qaoa" title="Permalink to this heading"></a></h1>
<p>by: Hanna Linn, WACQT Chalmers</p>
<p>This tutorial walks through performing protein folding of the hydrophobic-polar lattice model in two dimensions using Quantum Approximate Optimization Algorithm (QAOA).</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>In this tutorial, we start by defining our amino acid sequence of what we want to fold together with a lattice grid on which we want to fold our sequence. We then define an energy function that, given a folding (placement) of the sequence on the grid, gives us a potential. The goal is to find the folding with the lowest potential, called the native state of the amino acid sequence. We usually have more than one native state, all with the same energy. The process can be defined as an optimisation:</p>
<p>Given an energy function, <span class="math notranslate nohighlight">\(E(x)\)</span>, and a folding <span class="math notranslate nohighlight">\(x\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-93fe8c77-40b5-495c-950c-5d76fe4e9df1">
<span class="eqno">(1)<a class="headerlink" href="#equation-93fe8c77-40b5-495c-950c-5d76fe4e9df1" title="Permalink to this equation"></a></span>\[\begin{equation}
\begin{array}{ll&#64;{}ll}
\text{minimise}  &amp; E(x) &amp;\\
\text{subject to}&amp; x \in F, &amp; &amp;
\end{array}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(F\)</span> is the feasible solution set of the problem, i.e., all <span class="math notranslate nohighlight">\( x \in F\)</span> translates to physically possible protein folding.</p>
<p>For details of the energy function used in this tutorial, please see Irbäck et al. 2022:
https://journals.aps.org/prresearch/abstract/10.1103/PhysRevResearch.4.043013</p>
<p>Here, we aim to do the optimisation with the Quantum Approximate Optimization Algorithm (QAOA) using Pennylane https://pennylane.ai/qml/demos/tutorial_qaoa_intro</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">pennylane</span> <span class="k">as</span> <span class="nn">qml</span>
<span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">qaoa</span>
<span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">NullFormatter</span><span class="p">,</span> <span class="n">MaxNLocator</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="protein-model">
<h2>Protein model<a class="headerlink" href="#protein-model" title="Permalink to this heading"></a></h2>
<p>The HP-lattice model in two dimensions has two types of beads: H for hydrophobic and P for polar. We can make an instance of the model by defining the sequence with 1 for H and 0 for P and a lattice grid size.</p>
<p>The model is described in detail in Sec II. “Methods” part B “Binary quadratic model for HP lattice proteins – QUBO encoding” in Irbäck et al. 2022.
https://journals.aps.org/prresearch/abstract/10.1103/PhysRevResearch.4.043013</p>
<p>The energy function can be defined as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-efc71a41-b373-4b5c-b6a4-f2899627f33f">
<span class="eqno">(2)<a class="headerlink" href="#equation-efc71a41-b373-4b5c-b6a4-f2899627f33f" title="Permalink to this equation"></a></span>\[\begin{equation}
    E = E_{HP} + \sum_{i=1}^3 \lambda_i E_i,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(E_{HP}\)</span> is the energy term for the HP model and the terms <span class="math notranslate nohighlight">\(E_1\)</span>, <span class="math notranslate nohighlight">\(E_2\)</span> and <span class="math notranslate nohighlight">\(E_3\)</span> are constraint energies with the penalty vector <span class="math notranslate nohighlight">\(\lambda_i,\ i=1,2,3\)</span> controlling the strength of the constraints.</p>
<div class="amsmath math notranslate nohighlight" id="equation-5c001718-ead1-4d37-bf29-4f83f1ad0508">
<span class="eqno">(3)<a class="headerlink" href="#equation-5c001718-ead1-4d37-bf29-4f83f1ad0508" title="Permalink to this equation"></a></span>\[\begin{equation}
    E_{HP} = - \sum_{|f-f'|&gt;1}C(h_f, h_f') \sum_{(s,s')}\sigma_s^f\sigma_{s'}^{f'}
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-46541826-ebd9-4dd5-9067-3736fba3dc30">
<span class="eqno">(4)<a class="headerlink" href="#equation-46541826-ebd9-4dd5-9067-3736fba3dc30" title="Permalink to this equation"></a></span>\[\begin{equation}
    C(h_f,h_{f'}) =     \begin{cases}
      1, &amp; \text{if } h_f = h_{f'} = \text{H}, \\
      0, &amp; \text{otherwise}.
    \end{cases} 
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-3dfe92a9-582b-4762-a576-31b8158d16a1">
<span class="eqno">(5)<a class="headerlink" href="#equation-3dfe92a9-582b-4762-a576-31b8158d16a1" title="Permalink to this equation"></a></span>\[\begin{equation}
    E_1 = \sum_f \left(\sum_s\sigma_s^f-1\right)^2 + \left\{ \text{same for odd parity} \right\}
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-bfac3add-14a7-4171-b44c-927b3ec6b54f">
<span class="eqno">(6)<a class="headerlink" href="#equation-bfac3add-14a7-4171-b44c-927b3ec6b54f" title="Permalink to this equation"></a></span>\[\begin{equation}
    E_2 = \frac{1}{2} \sum_{f_1 \not = f_2} \sum_s \sigma_s^f\sum_{||s'-s||&gt;1} \sigma_{s'}^{f+1} + \left\{ \text{same for odd parity} \right\}
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-15132326-1259-4119-8f25-01910df99324">
<span class="eqno">(7)<a class="headerlink" href="#equation-15132326-1259-4119-8f25-01910df99324" title="Permalink to this equation"></a></span>\[\begin{equation}
\begin{split}
    E_3 =&amp; \sum_{1 \leq f&lt;N} \sum_s \sigma_s^f \sum_{||s'-s||&gt;1} \sigma_{s'}^{f+1} \\
    &amp; + \left\{ \text{same with odd/even parity interchanged} \right\},
\end{split}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_s^f\)</span> to describe the location of the even beads. The index <span class="math notranslate nohighlight">\(f\)</span> is the beads and <span class="math notranslate nohighlight">\(s\)</span> is the sites (’ are the odd beads and sites). The <span class="math notranslate nohighlight">\(\sigma_s^f=1\)</span> if bead <span class="math notranslate nohighlight">\(f\)</span> is located on site <span class="math notranslate nohighlight">\(s\)</span>, and <span class="math notranslate nohighlight">\(\sigma_s^f=0\)</span> otherwise, same for odds. The sites and beads are divided into odds and even to reduce the number of bits required from the number of amino acids times the area of the grid to half.</p>
<p>The terms in the energy function can be clumped together to one-body energy <span class="math notranslate nohighlight">\(O_i\)</span>, and two-body interaction <span class="math notranslate nohighlight">\(T_{ij}\)</span>, the pairwise interaction potentials.
The energy function to optimize can be written as</p>
<div class="amsmath math notranslate nohighlight" id="equation-4559b911-7ebe-4a73-965f-774eb1148ffe">
<span class="eqno">(8)<a class="headerlink" href="#equation-4559b911-7ebe-4a73-965f-774eb1148ffe" title="Permalink to this equation"></a></span>\[\begin{equation}
    E(x) = \underbrace{\sum^N_{i=1} O_i x_i}_\text{one-body} + \underbrace{\sum^{N-1}_{i=1}\sum^N_{j=i+1} T_{ij}x_ix_j}_\text{two-body},
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_i\)</span> is a bitstring representing the folding on the lattice. <span class="math notranslate nohighlight">\(x_1\)</span> is the choise, 1 for yes and 0 for no, of putting the first amino acid on position (0,0) on the grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">This cell is backend code. Don&#39;t mind it. Just run the cell.</span>

<span class="sd">HP-lattice Coordninate-based HP-lattice model</span>
<span class="sd">Written by Hanna Linn, hannlinn@chalmers.se</span>
<span class="sd">Based on Lucas Knuthsons code.</span>
<span class="sd">If used, please cite Irbäck et al. 2022: </span>
<span class="sd">https://journals.aps.org/prresearch/abstract/10.1103/PhysRevResearch.4.043013</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">CoordinateBased_HPLattice</span><span class="p">:</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Class for one instance of the 2D lattice HP-model to then be fed into the quantum simulation.</span>

<span class="sd">	Class variables in order of creation [type]:</span>
<span class="sd">	After init:</span>
<span class="sd">		- dim_lattice = dimensions of the lattice (rows, columns) [tuple of two ints]</span>
<span class="sd">		- lambda_vector = penalty terms for the energy terms [tuple of three ints]</span>
<span class="sd">		- sequence = Given sequence of the problem. Sequence format: H is 1 and 0 is P, e.g., [H, P, P, H] = [1, 0, 0, 1]. [list of int/binaries]</span>
<span class="sd">		- Q = dict with energy info [dictionary]</span>
<span class="sd">		- bit_name_list = names of the qubits saved in a list. Name format: (node [tuple], seq [int]) [list of tuples]</span>
<span class="sd">		- num_bits = number of bits in the instance [int]</span>
<span class="sd">		- O_energies = one-body energies [list of floats]</span>
<span class="sd">		- T_energies = two-body energies [list of Numpy Arrays with floats]</span>
<span class="sd">		- Dn = Dn vector [number of nodes for placements for each amino acid in sequence] [list] DOES NOT WORK FOR RECTANGULAR LATTICES!!!</span>

<span class="sd">	After function call:</span>
<span class="sd">		- feasible_set = Numpy arrays of all feasible bitstrings solutions in one-hot encoding [list of Numpy Arrays]</span>
<span class="sd">		- solution_set = Numpy arrays of all bitstring solutions in one-hot encoding [list of Numpy Arrays]</span>

<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_lattice</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">lambda_vector</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span> <span class="o">=</span> <span class="n">dim_lattice</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span> <span class="o">=</span> <span class="n">lambda_vector</span> <span class="c1"># best lambdas: lambda_1, lambda_2, lambda_3 = 1, 2, 1.5</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_Q</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bit_names</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">O_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_O_energies</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">T_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_T_energies</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_Dn</span><span class="p">()</span>

	<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">O:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">O_energies</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">T:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_energies</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_H_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		The following lists are lists of the indices where</span>
<span class="sd">		Hs are positioned.</span>
<span class="sd">		Used in make_Q.</span>
<span class="sd">		Based on code by: Lucas Knuthson</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">H_index_even</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
		<span class="n">H_index_odd</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">H_index_even</span><span class="p">,</span> <span class="n">H_index_odd</span>

	<span class="k">def</span> <span class="nf">combos_of_H</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Used in make_Q.</span>
<span class="sd">		Based on code by: Lucas Knuthson</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">H_index_even</span><span class="p">,</span> <span class="n">H_index_odd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_H_indices</span><span class="p">()</span>
		<span class="n">H_combos</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">even</span> <span class="ow">in</span> <span class="n">H_index_even</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">odd</span> <span class="ow">in</span> <span class="n">H_index_odd</span><span class="p">:</span>
				<span class="n">H_combos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">odd</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">H_combos</span>

	<span class="k">def</span> <span class="nf">split_evenodd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Split the sequence into a lists of odd and even beads.</span>
<span class="sd">		Cates = categories.</span>
<span class="sd">		Used in make_Q.</span>
<span class="sd">		Based on code by: Lucas Knuthson</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">cates_even</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">2</span> == 0]
		<span class="n">cates_odd</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">2</span> == 1]
		<span class="k">return</span> <span class="n">cates_even</span><span class="p">,</span> <span class="n">cates_odd</span>

	<span class="k">def</span> <span class="nf">make_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Q is the interactions in the ising model.</span>
<span class="sd">		Two-body energy: (q_1, q_2) = value</span>
<span class="sd">		One-body energy: (q_1, q_1) = value</span>

<span class="sd">		bit format: (node, seq. index)</span>
<span class="sd">		Node format: (row, col)</span>
<span class="sd">		Based on code by: Lucas Knuthson</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">Q</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

		<span class="n">cates_even</span><span class="p">,</span> <span class="n">cates_odd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_evenodd</span><span class="p">()</span>

		<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">grid_2d_graph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># makes a lattice as a graph</span>

		<span class="c1"># EPH</span>
		<span class="n">H_combos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combos_of_H</span><span class="p">()</span>
		<span class="n">count_HP</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="c1">#print(&#39;HP&#39;)</span>
		<span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">H_combos</span><span class="p">:</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">y</span><span class="p">))]</span> <span class="o">-=</span> <span class="mi">1</span>
						<span class="n">count_HP</span> <span class="o">+=</span> <span class="mi">1</span>
						<span class="c1">#print(&#39;-&#39;, ((u,x), (v,y)))</span>
					<span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">Q</span><span class="p">[((</span><span class="n">v</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">y</span><span class="p">))]</span> <span class="o">-=</span> <span class="mi">1</span>
						<span class="n">count_HP</span> <span class="o">+=</span> <span class="mi">1</span>
						<span class="c1">#print(&#39;-&#39;, ((v,x), (u,y)))</span>
					
		<span class="c1"># Sums over the squared sums, lambda 1</span>
		<span class="n">count_onper</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="c1">#print(&#39;Sums over the squared sums&#39;)</span>
		<span class="c1">#even</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cates_even</span><span class="p">:</span>
			<span class="c1"># One body</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
				<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">))]</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="n">count_onper</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="c1">#print(&#39;-&#39;, ((u,i), (u,i)))</span>

			<span class="c1"># Two body</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
				<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
					<span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
						<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">),(</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
						<span class="n">count_onper</span> <span class="o">+=</span> <span class="mi">1</span>
						<span class="c1">#print(((u,i),(v,i)))</span>

		<span class="c1">#odd</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cates_odd</span><span class="p">:</span>
			<span class="c1"># One body</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
				<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">),(</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">))]</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="n">count_onper</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="c1">#print(&#39;-&#39;, ((u,i),(u,i)))</span>

			<span class="c1"># Two body</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
				<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
					<span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
						<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">),(</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
						<span class="n">count_onper</span> <span class="o">+=</span> <span class="mi">1</span>
						<span class="c1">#print(((u,i),(v,i)))</span>

		<span class="c1"># self-avoidance, lambda 2</span>
		<span class="c1">#print(&#39;self-avoidance&#39;)</span>
		<span class="n">count_sa</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
			<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># even beads</span>
				<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cates_even</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cates_even</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
							<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">y</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
							<span class="n">count_sa</span> <span class="o">+=</span> <span class="mi">1</span>
							<span class="c1">#print(((u,x), (u,y)))</span>
			<span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># odd beads</span>
				<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cates_odd</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cates_odd</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
							<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">y</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
							<span class="n">count_sa</span> <span class="o">+=</span> <span class="mi">1</span>
							<span class="c1">#print(((u,x), (u,y)))</span>

		<span class="c1"># Connectivity sums, lambda 3</span>
		<span class="c1"># Even</span>
		<span class="c1">#print(&#39;Connectivity sums&#39;)</span>
		<span class="n">count_con</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cates_even</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
				<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
					<span class="k">if</span> <span class="p">(((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
							<span class="n">count_con</span> <span class="o">+=</span> <span class="mi">1</span>
							<span class="c1">#print(((u,i), (v,i+1)))</span>
							<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

						<span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">cates_even</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
								<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
								<span class="n">count_con</span> <span class="o">+=</span> <span class="mi">1</span>
								<span class="c1">#print(((u,i), (v,i+1)))</span>
		<span class="c1"># Odd</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cates_odd</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
				<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
					<span class="k">if</span> <span class="p">(((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span>
						<span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
							<span class="n">count_con</span> <span class="o">+=</span> <span class="mi">1</span>
							<span class="c1">#print(((u,i+1), (v,i)))</span>

						<span class="k">elif</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">cates_odd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
								<span class="n">count_con</span> <span class="o">+=</span> <span class="mi">1</span>
								<span class="c1">#print(((u,i+1), (v,i)))</span>
								<span class="n">Q</span><span class="p">[((</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">))]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

		<span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Counts:&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HP: &#39;</span><span class="p">,</span> <span class="n">count_HP</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;onper, lambda 1: &#39;</span><span class="p">,</span> <span class="n">count_onper</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self-avoidance, lambda 2: &#39;</span><span class="p">,</span> <span class="n">count_sa</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;connectivity, lambda 3: &#39;</span><span class="p">,</span> <span class="n">count_con</span><span class="p">)</span>

		<span class="n">Q</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="c1"># not a defaultdict anymore to not be able to grow by error</span>
		<span class="k">return</span> <span class="n">Q</span>

	<span class="k">def</span> <span class="nf">get_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns a list of the nodes in the right order: snakey!</span>
<span class="sd">		Verbose will print resulting list and saves a .png of the graph.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="p">(</span><span class="n">Lrow</span><span class="p">,</span> <span class="n">Lcol</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span>
		<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">grid_2d_graph</span><span class="p">(</span><span class="n">Lrow</span><span class="p">,</span> <span class="n">Lcol</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lrow</span><span class="p">):</span>
			<span class="n">start_index</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">Lcol</span>
			<span class="k">if</span> <span class="n">row</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># even row is forward</span>
				<span class="n">node_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="n">start_index</span><span class="p">:</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">Lcol</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">row</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># odd row is backward</span>
				<span class="n">node_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="n">start_index</span><span class="p">:</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">Lcol</span><span class="p">]))</span>
		<span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
			<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Lattice&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">node_list</span>

	<span class="k">def</span> <span class="nf">get_bit_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Returns a list of all the bitnames in the form (node (row, col), seq) in the right order.</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="n">seq_index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">))</span>
		<span class="n">node_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_list</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
		<span class="n">bit_name_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">L_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">nodes_even</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L_2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
		<span class="n">nodes_odd</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L_2</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
		<span class="c1"># for all even nodes with first index aso</span>
		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">seq_index</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">f</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nodes_even</span><span class="p">:</span>
					<span class="n">bit_name_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node_list</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">f</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">f</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nodes_odd</span><span class="p">:</span>
					<span class="n">bit_name_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node_list</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">f</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">bit_name_list</span>

	<span class="k">def</span> <span class="nf">get_O_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get the one-body energies for the Hamiltonian.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">O_energies</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">O_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[(</span><span class="n">bit</span><span class="p">,</span> <span class="n">bit</span><span class="p">)])</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">return</span> <span class="n">O_energies</span>

	<span class="k">def</span> <span class="nf">get_T_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Get the two-body energies for the Hamiltonian.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">T_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">))</span>

		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
					<span class="n">T_energies</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">T_energies</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
						<span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
							<span class="n">T_energies</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="k">pass</span>

		<span class="n">T_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">T_energies</span><span class="p">)</span> <span class="c1"># delete lower triangle</span>
		<span class="n">T_energies</span> <span class="o">=</span> <span class="n">T_energies</span> <span class="o">+</span> <span class="n">T_energies</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">T_energies</span><span class="p">))</span> <span class="c1"># copy upper triangle to lower triangle</span>
		<span class="k">return</span> <span class="n">T_energies</span>

	<span class="k">def</span> <span class="nf">get_Dn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Cardinality vector. Used for XY-mixer.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">D</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">seq</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">seq</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">D</span>

	<span class="k">def</span> <span class="nf">get_feasible_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feasible_set</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solution_set</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">get_solution_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Input: Number of bits.</span>
<span class="sd">		Output: Numpy arrays of dimensions (1, num_bits) in a list of all possible bitstrings.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">)]</span>

	<span class="k">def</span> <span class="nf">get_feasible_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Output: Numpy arrays of all feasible solutions, in a list.</span>
<span class="sd">		Hamming distance is 1 at each position.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">feasible_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">rot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dn</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">rot</span>
			<span class="n">index_perm</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)]</span>
			<span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_perm</span><span class="p">)</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
		<span class="n">comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">index_list</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">comb</span><span class="p">:</span>
			<span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
				<span class="n">state</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

			<span class="n">feasible</span> <span class="o">=</span> <span class="kc">True</span>

			<span class="c1"># same node and on?</span>
			<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">):</span>
				
				<span class="n">node1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">node2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[(</span><span class="n">b</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="o">==</span> <span class="n">node2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">state</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="ow">and</span> <span class="n">state</span><span class="p">[(</span><span class="n">b</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">]:</span>
					<span class="n">feasible</span> <span class="o">=</span> <span class="kc">False</span>
					<span class="k">break</span>
			
			<span class="c1"># longer distance than 1 manhattan distance</span>
			<span class="k">if</span> <span class="n">feasible</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">bit1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)):</span>
					<span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
					<span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="n">bit1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">bit2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bit1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)):</span>
							<span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="n">bit2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
								<span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
								<span class="n">node1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">bit1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
								<span class="n">node2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">bit2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
								<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manhattan_dist</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
									<span class="n">feasible</span> <span class="o">=</span> <span class="kc">False</span>
									<span class="k">break</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="k">continue</span>
			<span class="k">if</span> <span class="n">feasible</span><span class="p">:</span>
				<span class="n">feasible_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">feasible_list</span>

	<span class="k">def</span> <span class="nf">manhattan_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
		<span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">node1_i</span><span class="p">,</span> <span class="n">node2_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
			<span class="n">distance</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">node1_i</span> <span class="o">-</span> <span class="n">node2_i</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">calc_solution_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		May take a while.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">feasible_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feasible_set</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">solution_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_solution_set</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">bit2energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_array</span><span class="p">):</span>
		<span class="n">Oe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bit_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">O_energies</span><span class="p">)</span>

		<span class="n">Te</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">bit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">bit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">bit_array</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">bit_array</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
					<span class="n">Te</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_energies</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
					
		<span class="n">energy</span> <span class="o">=</span> <span class="n">Oe</span> <span class="o">+</span> <span class="n">Te</span>
		<span class="k">return</span> <span class="n">energy</span>

	<span class="k">def</span> <span class="nf">energy_of_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feasible</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="n">energy_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">mem</span> <span class="o">=</span> <span class="mi">1000000</span>
		<span class="n">lowest_energy_bitstring</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">feasible</span><span class="p">:</span>
			<span class="n">set_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feasible_set</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">set_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution_set</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set_</span><span class="p">)):</span>
			<span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit2energy</span><span class="p">(</span><span class="n">set_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

			<span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="k">1000</span>==0):
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Progress in energy calculations: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">set_</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit2energy</span><span class="p">(</span><span class="n">set_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="k">if</span> <span class="n">energy</span> <span class="o">&lt;</span> <span class="n">mem</span><span class="p">:</span>
					<span class="n">lowest_energy_bitstring</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">energy</span><span class="p">]</span>
					<span class="n">mem</span> <span class="o">=</span> <span class="n">energy</span>
				<span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">set_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
				<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
				<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
				<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">energy</span> <span class="o">=</span> <span class="mi">1000000</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">feasible</span><span class="p">:</span>
					<span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">set_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
					<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
					<span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
					<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
			<span class="n">energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done!&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">energy_list</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">lowest_energy_bitstring</span>

	<span class="k">def</span> <span class="nf">viz_solution_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_for_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">lowest_energy</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energy_for_set</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
			<span class="n">sort_idx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">]</span>
			<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)[</span><span class="n">sort_idx</span><span class="p">]</span>

		<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>
		<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_for_set</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">tick_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">)</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">sort</span><span class="p">:</span>
			<span class="n">theoretical_lowest_idx</span> <span class="o">=</span> <span class="n">lowest_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="n">theoretical_lowest_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>

		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bitstrings&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">85</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Classic energy&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Classic energy for &#39;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39; bitstrings&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">bit2coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit</span><span class="p">):</span>
		<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bit</span><span class="p">)):</span>
			<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
				<span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_name_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

	<span class="k">def</span> <span class="nf">viz_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit</span><span class="p">):</span>
		<span class="n">x_grid</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">x_grid</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_grid</span><span class="p">]</span>
		<span class="n">y_grid</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">protein_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_lattice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_grid</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">protein_grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

		<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit2coord</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
		<span class="c1">#x = [0, 0, 1, 1]</span>
		<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
		<span class="c1">#y = [0, 1, 1, 0]</span>
		
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># straight lines</span>
		<span class="c1"># large dots, set zorder=3 to draw the dots on top of the lines</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> 

		<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># enough margin so that the large scatter dots don&#39;t touch the borders</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span> <span class="c1"># equal distances in x and y direction</span>

		<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">NullFormatter</span><span class="p">())</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">NullFormatter</span><span class="p">())</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bit</span><span class="p">))</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">)):</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="c1"># ------------- util functions</span>

<span class="k">def</span> <span class="nf">sort_over_threshhold</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">threshhold</span><span class="p">):</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">threshhold</span>
	<span class="n">sort_idx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
	<span class="n">mask_idx</span> <span class="o">=</span> <span class="n">sort_idx</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">]]</span>
	<span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">mask_idx</span><span class="p">],</span> <span class="n">mask_idx</span>

<span class="k">def</span> <span class="nf">plot_probs_with_energy</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">ground_states_i</span><span class="p">,</span> <span class="n">new_fig</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">threshhold</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Plots given probailities with the corresponding bitstrings.</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">x</span><span class="p">,</span> <span class="n">mask_idx</span> <span class="o">=</span> <span class="n">sort_over_threshhold</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">threshhold</span><span class="p">)</span> <span class="c1"># probabilities</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No solutions with a probability over the given threshhold: &#39;</span><span class="p">,</span> <span class="n">threshhold</span><span class="p">)</span> 

	<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">probs</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)[</span><span class="n">mask_idx</span><span class="p">]</span>
	<span class="n">labels_y</span> <span class="o">=</span> <span class="n">index_set2bit_string</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">)</span> <span class="c1"># bit strings</span>

	<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">energies_of_set</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">)])</span> <span class="c1"># energies of the set</span>

	<span class="k">if</span> <span class="n">new_fig</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

	<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">constrained_layout</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
	<span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>  <span class="c1"># get the color of the sidebar correct</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span> <span class="c1"># clear plot</span>
	<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span> <span class="c1"># colorbar on the side</span>
	<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Classic energy&#39;</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>

	<span class="n">norm</span>  <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
	<span class="n">norms</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

	<span class="n">colors</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">(</span><span class="n">norms</span><span class="p">)</span>  <span class="c1"># get the colors of the columns</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">)</span> <span class="c1"># plot the columns with the probabilities as the hight of the bar, colors are classical energy</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels_y</span><span class="p">)</span> <span class="c1"># bit strings as labels</span>
	
	<span class="c1"># mark out the best bit in green</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">energy_of_index</span><span class="p">(</span><span class="n">ground_states_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">H_cost</span><span class="p">),</span> <span class="mi">4</span><span class="p">):</span>
	    	<span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>

	<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Probability of measuring bit strings with energy&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">17</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">85</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
		<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> 
		<span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m_</span><span class="si">%d</span><span class="s2">_%Y&quot;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_probs_with_energy_&#39;</span> <span class="o">+</span> <span class="n">date_time</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>


<span class="c1"># Energy functions</span>

<span class="k">def</span> <span class="nf">energies_of_set</span><span class="p">(</span><span class="n">_set</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Set can be indices or arrays.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">num_qubits</span><span class="p">:</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="n">bit_array_set2indices</span><span class="p">(</span><span class="n">_set</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">indices</span> <span class="o">=</span> <span class="n">_set</span>
	<span class="n">energies_index_states</span> <span class="o">=</span> <span class="n">get_energies_index_states</span><span class="p">(</span><span class="n">H_cost</span><span class="p">)</span>
	<span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">energies_index_states</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">energies</span>

<span class="k">def</span> <span class="nf">get_energies_index_states</span><span class="p">(</span><span class="n">H_cost</span><span class="p">):</span>
	<span class="c1">#print(&#39;\nCalculating energy of states&#39;)</span>
	<span class="n">energy_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">matrix</span> <span class="o">=</span> <span class="n">H_cost</span><span class="o">.</span><span class="n">sparse_matrix</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="c1"># some weird thing at the conversion demands a round, it should not matter at 8th decimal</span>

<span class="k">def</span> <span class="nf">energy_of_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">):</span>
	<span class="n">energies_index_states</span> <span class="o">=</span> <span class="n">get_energies_index_states</span><span class="p">(</span><span class="n">H_cost</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">energies_index_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

<span class="c1"># Ground states</span>

<span class="k">def</span> <span class="nf">get_ground_states_i</span><span class="p">(</span><span class="n">feasible_set</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">):</span>
	<span class="n">indices_of_feasible</span> <span class="o">=</span> <span class="n">bit_array_set2indices</span><span class="p">(</span><span class="n">feasible_set</span><span class="p">)</span>
	<span class="n">energies_of_feasible</span> <span class="o">=</span> <span class="n">energies_of_set</span><span class="p">(</span><span class="n">indices_of_feasible</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feasible_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
	<span class="n">ground_energy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">energies_of_feasible</span><span class="p">)),</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># just to avoid a weird 4 at the 20th decimal</span>
	<span class="n">ground_states_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indices_of_feasible</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">energies_of_feasible</span> <span class="o">&lt;=</span> <span class="n">ground_energy</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">ground_energy</span><span class="p">,</span> <span class="n">ground_states_i</span>

<span class="c1"># Transforms: strings &lt;-&gt; bit_array</span>

<span class="k">def</span> <span class="nf">bit_array_set2indices</span><span class="p">(</span><span class="n">bit_array_set</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">bit_array2index</span><span class="p">,</span> <span class="n">bit_array_set</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">bit_array2index</span><span class="p">(</span><span class="n">bit_array</span><span class="p">):</span>
	<span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">bit_array</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">bit_array</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bit_array</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">index_set2bit_string</span><span class="p">(</span><span class="n">index_set</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Input: Indices of a set of bit strings in a list, e.g. [12, 542, 1].</span>
<span class="sd">	Output: The whole set of bits in a list, e.g. np array of bit string, e.g. [1000100, 110101, 101010].</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">packed_index_set</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index_set</span><span class="p">:</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">index2bit_string</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">)</span>
		<span class="n">packed_index_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">packed_index_set</span>

<span class="k">def</span> <span class="nf">bit_array2string</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
	<span class="n">bit_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">bit_string</span> <span class="o">+=</span> <span class="s1">&#39;1&#39;</span>
		<span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">bit_string</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span>
	<span class="k">return</span> <span class="n">bit_string</span>

<span class="k">def</span> <span class="nf">string2index</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
	<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">index2bit_string</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Input: Index in pennylane basis, to be used in e.g. probability vector.</span>
<span class="sd">	Output: bit_string of a state as a string, e.g. &#39;1000100&#39;.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">string</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">index</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
	<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_qubits</span><span class="p">:</span>
		<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">string</span>
	<span class="k">return</span> <span class="n">string</span>

<span class="c1"># Grid search</span>

<span class="k">def</span> <span class="nf">grid_search</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span>
					<span class="n">stop_gamma</span><span class="p">,</span>
					<span class="n">num_points_gamma</span><span class="p">,</span>
					<span class="n">start_beta</span><span class="p">,</span>
					<span class="n">stop_beta</span><span class="p">,</span>
					<span class="n">num_points_beta</span><span class="p">,</span>
					<span class="n">heuristic</span><span class="p">,</span>
					<span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
					<span class="n">matplot_save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">above</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">vmap</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">jax_GPU</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Calculates the best parameters [gamma, beta], gives the lowest average cost, within the interval given.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">batch_array</span> <span class="o">=</span> <span class="n">get_batch_array</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span>
					<span class="n">stop_gamma</span><span class="p">,</span>
					<span class="n">num_points_gamma</span><span class="p">,</span>
					<span class="n">start_beta</span><span class="p">,</span>
					<span class="n">stop_beta</span><span class="p">,</span>
					<span class="n">num_points_beta</span><span class="p">)</span>
	<span class="c1"># gamma</span>
	<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span> <span class="n">stop_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">)</span>
	<span class="c1"># beta</span>
	<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_beta</span><span class="p">,</span> <span class="n">stop_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">vmap</span><span class="p">:</span>
		<span class="kn">import</span> <span class="nn">jax</span>
		<span class="kn">from</span> <span class="nn">jax.config</span> <span class="kn">import</span> <span class="n">config</span>
		<span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">jax_GPU</span><span class="p">:</span>
			<span class="n">jit_circuit</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">heuristic</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;gpu&#39;</span><span class="p">))</span> <span class="c1"># tries to allocate to much memory if GPU</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">jit_circuit</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">heuristic</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">))</span> <span class="c1"># tries to allocate to much memory if GPU</span>
		<span class="n">Z</span> <span class="o">=</span> <span class="n">jit_circuit</span><span class="p">(</span><span class="n">batch_array</span><span class="p">)</span>
		<span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_points_gamma</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">m</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Y</span><span class="p">):</span>
				<span class="n">Z</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">heuristic</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)],[</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)]])</span>

	<span class="c1"># Find best Z</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">argmin</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
		<span class="n">plot_grid_search</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="n">above</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="n">save</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">matplot_save</span><span class="p">:</span>
		<span class="n">mdic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Z_av&#39;</span><span class="p">:</span> <span class="n">Z</span><span class="p">,</span>
		<span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span> <span class="n">stop_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">),</span>
		<span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_beta</span><span class="p">,</span> <span class="n">stop_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">)}</span>
		<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> 
		<span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m_</span><span class="si">%d</span><span class="s2">_%Y&quot;</span><span class="p">)</span>
		<span class="n">savemat</span><span class="p">(</span><span class="s1">&#39;Matlab_&#39;</span> <span class="o">+</span> <span class="n">date_time</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_points_gamma</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.mat&#39;</span><span class="p">,</span> <span class="n">mdic</span><span class="p">)</span>

	<span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
	<span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">gamma</span><span class="p">],</span> <span class="p">[</span><span class="n">beta</span><span class="p">]]),</span> <span class="n">Z</span><span class="p">,</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">get_batch_array</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span>
					<span class="n">stop_gamma</span><span class="p">,</span>
					<span class="n">num_points_gamma</span><span class="p">,</span>
					<span class="n">start_beta</span><span class="p">,</span>
					<span class="n">stop_beta</span><span class="p">,</span>
					<span class="n">num_points_beta</span><span class="p">):</span>
	<span class="c1"># gamma</span>
	<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span> <span class="n">stop_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">)</span>
	<span class="c1"># beta</span>
	<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_beta</span><span class="p">,</span> <span class="n">stop_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">)</span>
	<span class="n">batch_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">Y</span><span class="p">:</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)],[</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
			<span class="n">batch_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

	<span class="n">batch_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">batch_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">batch_array</span>

<span class="k">def</span> <span class="nf">plot_grid_search</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
					<span class="n">Y</span><span class="p">,</span>
					<span class="n">Z</span><span class="p">,</span>
					<span class="n">i</span><span class="p">,</span>
					<span class="n">above</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
					<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">13</span><span class="p">):</span>
	<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
	<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
	<span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">BrBG</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">))</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;best params&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Best params: $\gamma$ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;, $\beta$ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
	<span class="n">num_points_gamma</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\gamma$ (cost parameter)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\beta$ (mixer parameter)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_num_gamma&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_points_gamma</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">above</span><span class="p">:</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_above_num_gamma&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_points_gamma</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">vec_grid_search_p2</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span>
						<span class="n">stop_gamma</span><span class="p">,</span>
						<span class="n">num_points_gamma</span><span class="p">,</span>
						<span class="n">start_beta</span><span class="p">,</span>
						<span class="n">stop_beta</span><span class="p">,</span>
						<span class="n">num_points_beta</span><span class="p">,</span>
						<span class="n">heuristic</span><span class="p">,</span>
						<span class="n">vmap</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Calculates the best parameters [gamma, beta] for p=2, gives the lowest cost, within the interval given.</span>
<span class="sd">	If vmap is on then JAX and JIT is used for speeding up the calculations.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="c1"># gamma</span>
	<span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span> <span class="n">stop_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">)</span>
	<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span> <span class="n">stop_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">)</span>
	<span class="c1"># beta</span>
	<span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_beta</span><span class="p">,</span> <span class="n">stop_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">)</span>
	<span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_beta</span><span class="p">,</span> <span class="n">stop_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">vmap</span><span class="p">:</span>
		<span class="n">batch_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">x1</span> <span class="ow">in</span> <span class="n">X1</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">x2</span> <span class="ow">in</span> <span class="n">X2</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">y1</span> <span class="ow">in</span> <span class="n">Y1</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">y2</span> <span class="ow">in</span> <span class="n">Y2</span><span class="p">:</span>
						<span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">x2</span><span class="p">)],[</span><span class="nb">float</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y2</span><span class="p">)]])</span>
						<span class="n">batch_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Batch list done!&#39;</span><span class="p">)</span>

		<span class="n">batch_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">batch_list</span><span class="p">)</span>
		<span class="kn">import</span> <span class="nn">jax</span>
		<span class="kn">from</span> <span class="nn">jax.config</span> <span class="kn">import</span> <span class="n">config</span>
		<span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

		<span class="n">jit_circuit</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">heuristic</span><span class="p">))</span>
		<span class="n">Z</span> <span class="o">=</span> <span class="n">jit_circuit</span><span class="p">(</span><span class="n">batch_array</span><span class="p">)</span>
		<span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y2</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_points_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">x1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X1</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">xj</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X2</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">yi</span><span class="p">,</span><span class="n">y1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Y1</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">yj</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Y2</span><span class="p">):</span>
						<span class="n">Z</span><span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">yj</span><span class="p">]</span> <span class="o">=</span> <span class="n">heuristic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">x2</span><span class="p">)],[</span><span class="nb">float</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y2</span><span class="p">)]]))</span>

	<span class="c1"># Find best Z</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">argmin</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
	
	<span class="n">gamma1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">X1</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
	<span class="n">gamma2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
	<span class="n">beta1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Y1</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
	<span class="n">beta2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Y1</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">],</span> <span class="p">[</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">]]),</span> <span class="n">Z</span>


<span class="k">def</span> <span class="nf">get_annealing_params</span><span class="p">(</span><span class="n">annealing_time</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cosine</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sine</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	From Tutorial 3 AdvQuantumAlgorithms Course.</span>

<span class="sd">	Sine function does not work.</span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">linear</span><span class="p">,</span> <span class="n">cosine</span><span class="p">,</span> <span class="n">sine</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Choose one schedule&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">linear</span><span class="p">,</span> <span class="n">cosine</span><span class="p">,</span> <span class="n">sine</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Choose a schedule&#39;</span><span class="p">)</span>

	<span class="n">annealing_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
	<span class="n">tau</span> <span class="o">=</span> <span class="n">annealing_time</span><span class="o">/</span><span class="n">p</span>
	<span class="k">if</span> <span class="n">linear</span><span class="p">:</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;linear_&#39;</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
			<span class="n">annealing_params</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">p</span> <span class="c1"># gamma  Trotterisation to 2nd order</span>
			<span class="n">annealing_params</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">tau</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">))</span> <span class="c1"># beta</span>
		<span class="n">annealing_params</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">tau</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="c1"># Trotterisation to 2nd order</span>

	<span class="k">elif</span> <span class="n">cosine</span><span class="p">:</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cosine_&#39;</span>
		<span class="n">B_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
			<span class="n">annealing_params</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">B_function</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span>
			<span class="n">annealing_params</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">tau</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">B_function</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">B_function</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">))</span>
		<span class="n">annealing_params</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">tau</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">B_function</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">))</span>

	<span class="k">elif</span> <span class="n">sine</span><span class="p">:</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sine_&#39;</span>
		<span class="n">B_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
			<span class="n">annealing_params</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">B_function</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span>
			<span class="n">annealing_params</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">tau</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">B_function</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">B_function</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">))</span>
		<span class="n">annealing_params</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">tau</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">B_function</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">))</span>

	<span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">save</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Must save the parameters to be able to plot&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
		<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_params&#39;</span> <span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">,</span> <span class="n">annealing_params</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
			<span class="n">plot_params</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">annealing_params</span>

<span class="k">def</span> <span class="nf">interpolate_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">only_last</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	By Lucin appendix B, p 14</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">params_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">params_p_plus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">params_p_plus1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
		<span class="n">params_p_plus1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">only_last</span><span class="p">:</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">p</span>
		<span class="n">params_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
		<span class="n">params_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">params_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
		<span class="n">return_params</span> <span class="o">=</span> <span class="n">params_vector</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">return_params</span> <span class="o">=</span> <span class="n">params_p_plus1</span>

	<span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">save</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Must save the parameters to be able to plot&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;interpolated&#39;</span>
		<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_params&#39;</span> <span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">,</span> <span class="n">return_params</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
			<span class="n">plot_params</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">return_params</span>

<span class="k">def</span> <span class="nf">plot_params</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color2</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">trained</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
	<span class="n">params</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_params&#39;</span> <span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
	<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\gamma$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\beta$&#39;</span><span class="p">]</span>
	<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">color2</span><span class="p">:</span> 
		<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;coral&#39;</span><span class="p">,</span> <span class="s1">&#39;seagreen&#39;</span><span class="p">]</span>
	<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">trained</span><span class="o">+</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="o">+</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">19</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">19</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Radians&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">17</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">save</span><span class="p">:</span>

		<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;plot_params&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_minimal_energy_gap</span><span class="p">(</span><span class="n">H_cost</span><span class="p">):</span>
	<span class="n">get_energies_index_states</span><span class="p">(</span><span class="n">H_cost</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">energies_index_states</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make an instance for the protein</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#HPPH</span>
<span class="n">L1</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">L2</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">lambda_vector</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span> <span class="c1"># see Fig.2 in Irbäck et al.</span>

<span class="n">protein</span> <span class="o">=</span> <span class="n">CoordinateBased_HPLattice</span><span class="p">((</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">),</span> <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">lambda_vector</span> <span class="o">=</span> <span class="n">lambda_vector</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span>
<span class="n">protein</span><span class="o">.</span><span class="n">calc_solution_sets</span><span class="p">()</span>
<span class="n">feasible_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">protein</span><span class="o">.</span><span class="n">feasible_set</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;What all bits are, on the format ((x,y)-coordninate on the grid, which index of the sequence): &#39;</span><span class="p">,</span> <span class="n">protein</span><span class="o">.</span><span class="n">get_bit_names</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of bits needed to encode one folding: &#39;</span><span class="p">,</span> <span class="n">protein</span><span class="o">.</span><span class="n">num_bits</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The quotient of size of feasible set compared to the total solution set:&#39;</span><span class="p">,</span> <span class="n">protein</span><span class="o">.</span><span class="n">get_feasible_percentage</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>O:
[-2.1, -2.1, -2.1, -2.1, -2.1, -2.1, -2.1, -2.1, -2.1, -2.1, -2.1, -2.1]
T:
[[ 0.   4.2  4.2  0.   0.   3.   2.4  0.   0.  -1.  -1.   0. ]
 [ 4.2  0.   4.2  0.   0.   0.   0.   2.4  0.  -1.  -1.  -1. ]
 [ 4.2  4.2  0.   3.   0.   0.   0.   0.   2.4  0.  -1.  -1. ]
 [ 0.   0.   3.   0.   4.2  4.2  0.   0.   3.   2.4  0.   0. ]
 [ 0.   0.   0.   4.2  0.   4.2  0.   0.   0.   0.   2.4  0. ]
 [ 3.   0.   0.   4.2  4.2  0.   3.   0.   0.   0.   0.   2.4]
 [ 2.4  0.   0.   0.   0.   3.   0.   4.2  4.2  0.   0.   3. ]
 [ 0.   2.4  0.   0.   0.   0.   4.2  0.   4.2  0.   0.   0. ]
 [ 0.   0.   2.4  3.   0.   0.   4.2  4.2  0.   3.   0.   0. ]
 [-1.  -1.   0.   2.4  0.   0.   0.   0.   3.   0.   4.2  4.2]
 [-1.  -1.  -1.   0.   2.4  0.   0.   0.   0.   4.2  0.   4.2]
 [ 0.  -1.  -1.   0.   0.   2.4  3.   0.   0.   4.2  4.2  0. ]]

What all bits are, on the format ((x,y)-coordninate on the grid, which index of the sequence):  [((0, 0), 0), ((1, 1), 0), ((2, 0), 0), ((0, 1), 1), ((1, 0), 1), ((2, 1), 1), ((0, 0), 2), ((1, 1), 2), ((2, 0), 2), ((0, 1), 3), ((1, 0), 3), ((2, 1), 3)] 

The number of bits needed to encode one folding:  12 

The quotient of size of feasible set compared to the total solution set: 0.341796875 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw the protein</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First solution in the feasible solution set: &#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">feasible_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">protein</span><span class="o">.</span><span class="n">get_bit_names</span><span class="p">()</span>
<span class="nb">print</span><span class="p">([</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="p">])</span>

<span class="n">protein</span><span class="o">.</span><span class="n">viz_lattice</span><span class="p">(</span><span class="n">feasible_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First solution in the feasible solution set: 
[((0, 0), 0), ((0, 1), 1), ((1, 1), 2), ((1, 0), 3)]
</pre></div>
</div>
<img alt="../../_images/71beded2e3ef5857a7663957c7cbcf2d86682c42bdc1710f6c3a6cdac56204f6.png" src="../../_images/71beded2e3ef5857a7663957c7cbcf2d86682c42bdc1710f6c3a6cdac56204f6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw all proteins in feasible solution set</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">feasible_set</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="n">protein</span><span class="o">.</span><span class="n">viz_lattice</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/71beded2e3ef5857a7663957c7cbcf2d86682c42bdc1710f6c3a6cdac56204f6.png" src="../../_images/71beded2e3ef5857a7663957c7cbcf2d86682c42bdc1710f6c3a6cdac56204f6.png" />
<img alt="../../_images/1fa92c18d2de6cddd4d508192645a9004336003657eb1709560cd80d9b614d8b.png" src="../../_images/1fa92c18d2de6cddd4d508192645a9004336003657eb1709560cd80d9b614d8b.png" />
<img alt="../../_images/d9412cd6277e69245bbf42f280b008623a35871503a4ddb42c1934802f457d2c.png" src="../../_images/d9412cd6277e69245bbf42f280b008623a35871503a4ddb42c1934802f457d2c.png" />
<img alt="../../_images/63e1906472d56c118e7deaba1c18d32376681e1dc454f807a6e6b5e1500e2567.png" src="../../_images/63e1906472d56c118e7deaba1c18d32376681e1dc454f807a6e6b5e1500e2567.png" />
<img alt="../../_images/b6bb4f6104945df1f4a8adf0436052c0fc2fc3d0e78e05a8a40a3806b2304ba3.png" src="../../_images/b6bb4f6104945df1f4a8adf0436052c0fc2fc3d0e78e05a8a40a3806b2304ba3.png" />
<img alt="../../_images/36af0749fe554e7df94fa36f09c8091d32fb4715c2105d82197c3b60dbd1808f.png" src="../../_images/36af0749fe554e7df94fa36f09c8091d32fb4715c2105d82197c3b60dbd1808f.png" />
<img alt="../../_images/98d3ae9158ef75179615fcd867aa28977a932604b14953dabdd116b43351ebb9.png" src="../../_images/98d3ae9158ef75179615fcd867aa28977a932604b14953dabdd116b43351ebb9.png" />
<img alt="../../_images/60f66acf47b1c13ad66289c7c1560aefcba18577b371e0db5ad0bff3c0b7604c.png" src="../../_images/60f66acf47b1c13ad66289c7c1560aefcba18577b371e0db5ad0bff3c0b7604c.png" />
<img alt="../../_images/1d2fc0b967f41c729c9def0b590e948aa222770ba9b185531d4b0a42a0ebddef.png" src="../../_images/1d2fc0b967f41c729c9def0b590e948aa222770ba9b185531d4b0a42a0ebddef.png" />
<img alt="../../_images/a65a7ca6aab242c6e81ddfd50e3e030f412c69eadc846e115e1f37630ee2685a.png" src="../../_images/a65a7ca6aab242c6e81ddfd50e3e030f412c69eadc846e115e1f37630ee2685a.png" />
<img alt="../../_images/e91303e4796466d7fc64edf50efe479222326e34b50ee0e828df01559d618036.png" src="../../_images/e91303e4796466d7fc64edf50efe479222326e34b50ee0e828df01559d618036.png" />
<img alt="../../_images/3c590e7081bab1581aec50b673f6ee69a1ea77f6d0553a1542ee98aefd3cb403.png" src="../../_images/3c590e7081bab1581aec50b673f6ee69a1ea77f6d0553a1542ee98aefd3cb403.png" />
<img alt="../../_images/60c0349f32673340082f9a9883eff5e0e7032bac4ae023c98b79ceccf655dbdc.png" src="../../_images/60c0349f32673340082f9a9883eff5e0e7032bac4ae023c98b79ceccf655dbdc.png" />
<img alt="../../_images/d1966285d180e5cafbc44b3cd0c83fd4888a34d93a97cf2ecef81476863f3987.png" src="../../_images/d1966285d180e5cafbc44b3cd0c83fd4888a34d93a97cf2ecef81476863f3987.png" />
</div>
</div>
</section>
<section id="quantum-approximate-optimization-algorithm-qaoa">
<h2>Quantum Approximate Optimization Algorithm (QAOA)<a class="headerlink" href="#quantum-approximate-optimization-algorithm-qaoa" title="Permalink to this heading"></a></h2>
<div class="math notranslate nohighlight">
\[\newcommand{\ket}[1]{\left|{#1}\right\rangle}\]</div>
<div class="math notranslate nohighlight">
\[\newcommand{\bra}[1]{\left\langle{#1}\right|}\]</div>
<div class="math notranslate nohighlight">
\[\newcommand{\braket}[2]{\left\langle{#1}\middle|{#2}\right\rangle}\]</div>
<p>In QAOA, the circuit is done in a sequence of depth <span class="math notranslate nohighlight">\(p\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-863ad110-49d3-49f9-be7e-d1182e60af7a">
<span class="eqno">(9)<a class="headerlink" href="#equation-863ad110-49d3-49f9-be7e-d1182e60af7a" title="Permalink to this equation"></a></span>\[\begin{equation}
    \begin{split}
        \ket{\psi_p(\gamma, \beta)} = &amp; e^{-i\beta_p H_{mixer}} e^{-i\gamma_p H_{\text{cost}}}\\
        &amp;... e^{-i\beta_1 H_{mixer}} e^{-i\gamma_1 H_{\text{cost}}} \ket{\psi_{\text{init.}}},
    \end{split}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\gamma\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are vectors of parameters to optimise by a classical computer so that the probability of measuring the optimal state is high.</p>
<p>The function to optimise is often the expectation value</p>
<div class="amsmath math notranslate nohighlight" id="equation-63dd80fa-1d5b-4986-8a3b-792b3f1744a5">
<span class="eqno">(10)<a class="headerlink" href="#equation-63dd80fa-1d5b-4986-8a3b-792b3f1744a5" title="Permalink to this equation"></a></span>\[\begin{equation}
    C_{\text{obj.}} = \bra{\psi_p(\gamma, \beta)}H_{cost}\ket{\psi_p(\gamma, \beta)},
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(C_{\text{obj.}}\)</span> is the energy function in our case.
If we get the lowest expectation value, we should get the answer with the lowest energy.</p>
<p>For details on how to run QAOA in Pennylane: https://pennylane.ai/qml/demos/tutorial_qaoa_intro</p>
<section id="protein-instance-into-cost-hamiltonian">
<h3>Protein instance into cost Hamiltonian<a class="headerlink" href="#protein-instance-into-cost-hamiltonian" title="Permalink to this heading"></a></h3>
<p>Here, we create a cost Hamiltonian from the protein by translating the binary variables <span class="math notranslate nohighlight">\(x_i=\{0,1\}\)</span> to spin <span class="math notranslate nohighlight">\(q_i=\{1,-1\}\)</span> for the qubits. We end up with a problem on the form of an Ising Hamiltonian:</p>
<div class="amsmath math notranslate nohighlight" id="equation-271c5551-fd64-4c45-a345-6b29a7d2b08d">
<span class="eqno">(11)<a class="headerlink" href="#equation-271c5551-fd64-4c45-a345-6b29a7d2b08d" title="Permalink to this equation"></a></span>\[\begin{equation}
    H_{\text{cost}} = \sum_i h_i \sigma_i^z + \sum_{ij} J_{ij} \sigma_i^z \sigma_j^z,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(h_i\)</span> are the field constants applied to qubit <span class="math notranslate nohighlight">\(i\)</span> translated from the one-body energies, <span class="math notranslate nohighlight">\(J_{ij}\)</span> are the two-body interaction constants between qubit <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> translated from the two-body energies and <span class="math notranslate nohighlight">\(\sigma^z\)</span> is the Pauli operator in the <span class="math notranslate nohighlight">\(z\)</span>-direction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">protein_folding_hamiltonian</span><span class="p">(</span><span class="n">ProteinInstance</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Input: Protein instance from CoordinateBased_HPLattice or RotamerRosetta.</span>
<span class="sd">	Returns: The hamiltonian for the protein instance.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">num_qubits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ProteinInstance</span><span class="o">.</span><span class="n">O_energies</span><span class="p">)</span>
	<span class="n">wires</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">ProteinInstance</span><span class="o">.</span><span class="n">num_bits</span><span class="p">)</span>

	<span class="n">O_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ProteinInstance</span><span class="o">.</span><span class="n">O_energies</span><span class="p">]</span> 

	<span class="n">T_coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ProteinInstance</span><span class="o">.</span><span class="n">T_energies</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">):</span>                         
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">):</span>
			<span class="n">T_coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span>

	<span class="n">H_cost</span> <span class="o">=</span> <span class="n">get_cost_hamiltonian</span><span class="p">(</span><span class="n">O_coeffs</span><span class="p">,</span> <span class="n">T_coeffs</span><span class="p">,</span> <span class="n">wires</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">H_cost</span>

<span class="k">def</span> <span class="nf">get_cost_hamiltonian</span><span class="p">(</span><span class="n">O_coeffs</span><span class="p">,</span> <span class="n">T_coeffs</span><span class="p">,</span> <span class="n">wires</span><span class="p">):</span>
	<span class="n">H_cost_O</span> <span class="o">=</span> <span class="n">get_O_hamiltonian</span><span class="p">(</span><span class="n">O_coeffs</span><span class="p">,</span> <span class="n">wires</span><span class="p">)</span>
	<span class="n">H_cost_T</span> <span class="o">=</span> <span class="n">get_T_hamiltonian</span><span class="p">(</span><span class="n">T_coeffs</span><span class="p">,</span> <span class="n">wires</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">H_cost_O</span> <span class="o">+</span> <span class="n">H_cost_T</span>

<span class="k">def</span> <span class="nf">get_O_hamiltonian</span><span class="p">(</span><span class="n">O_coeffs</span><span class="p">,</span> <span class="n">wires</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">qml</span><span class="o">.</span><span class="n">Hamiltonian</span><span class="p">(</span><span class="n">O_coeffs</span><span class="p">,</span> <span class="p">[</span><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wires</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">get_T_hamiltonian</span><span class="p">(</span><span class="n">T_coeffs</span><span class="p">,</span> <span class="n">wires</span><span class="p">):</span>
	<span class="n">obs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">coeffs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wires</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">)):</span>
			<span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T_coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">])</span> 
			<span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">T_coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
			<span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">T_coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
			<span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">@</span> <span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
			<span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
			<span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">qml</span><span class="o">.</span><span class="n">Hamiltonian</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make into Hamiltonian</span>
<span class="n">H_cost</span> <span class="o">=</span> <span class="n">protein_folding_hamiltonian</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span>
<span class="n">num_qubits</span> <span class="o">=</span> <span class="n">protein</span><span class="o">.</span><span class="n">num_bits</span>
<span class="n">qubits</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">protein</span><span class="o">.</span><span class="n">num_bits</span><span class="p">)</span> <span class="c1"># naming the qubits</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H_cost:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">H_cost</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>H_cost:
  (-3.1500000000000004) [Z6]
+ (-3.1500000000000004) [Z8]
+ (-3.15) [Z3]
+ (-3.15) [Z5]
+ (-1.9) [Z9]
+ (-1.9) [Z11]
+ (-1.9) [Z0]
+ (-1.9) [Z2]
+ (-1.65) [Z7]
+ (-1.65) [Z4]
+ (-0.8999999999999999) [Z10]
+ (-0.8999999999999999) [Z1]
+ (-0.25) [Z0 Z9]
+ (-0.25) [Z0 Z10]
+ (-0.25) [Z1 Z9]
+ (-0.25) [Z1 Z10]
+ (-0.25) [Z1 Z11]
+ (-0.25) [Z2 Z10]
+ (-0.25) [Z2 Z11]
+ (0.0) [Z0 Z3]
+ (0.0) [Z0 Z4]
+ (0.0) [Z0 Z7]
+ (0.0) [Z0 Z8]
+ (0.0) [Z0 Z11]
+ (0.0) [Z1 Z3]
+ (0.0) [Z1 Z4]
+ (0.0) [Z1 Z5]
+ (0.0) [Z1 Z6]
+ (0.0) [Z1 Z8]
+ (0.0) [Z2 Z4]
+ (0.0) [Z2 Z5]
+ (0.0) [Z2 Z6]
+ (0.0) [Z2 Z7]
+ (0.0) [Z2 Z9]
+ (0.0) [Z3 Z6]
+ (0.0) [Z3 Z7]
+ (0.0) [Z3 Z10]
+ (0.0) [Z3 Z11]
+ (0.0) [Z4 Z6]
+ (0.0) [Z4 Z7]
+ (0.0) [Z4 Z8]
+ (0.0) [Z4 Z9]
+ (0.0) [Z4 Z11]
+ (0.0) [Z5 Z7]
+ (0.0) [Z5 Z8]
+ (0.0) [Z5 Z9]
+ (0.0) [Z5 Z10]
+ (0.0) [Z6 Z9]
+ (0.0) [Z6 Z10]
+ (0.0) [Z7 Z9]
+ (0.0) [Z7 Z10]
+ (0.0) [Z7 Z11]
+ (0.0) [Z8 Z10]
+ (0.0) [Z8 Z11]
+ (0.6) [Z0 Z6]
+ (0.6) [Z1 Z7]
+ (0.6) [Z2 Z8]
+ (0.6) [Z3 Z9]
+ (0.6) [Z4 Z10]
+ (0.6) [Z5 Z11]
+ (0.75) [Z0 Z5]
+ (0.75) [Z2 Z3]
+ (0.75) [Z3 Z8]
+ (0.75) [Z5 Z6]
+ (0.75) [Z6 Z11]
+ (0.75) [Z8 Z9]
+ (1.05) [Z0 Z1]
+ (1.05) [Z0 Z2]
+ (1.05) [Z1 Z2]
+ (1.05) [Z3 Z4]
+ (1.05) [Z3 Z5]
+ (1.05) [Z4 Z5]
+ (1.05) [Z6 Z7]
+ (1.05) [Z6 Z8]
+ (1.05) [Z7 Z8]
+ (1.05) [Z9 Z10]
+ (1.05) [Z9 Z11]
+ (1.05) [Z10 Z11]
</pre></div>
</div>
</div>
</div>
</section>
<section id="ground-state-of-the-cost-hamiltonian">
<h3>Ground state of the cost Hamiltonian<a class="headerlink" href="#ground-state-of-the-cost-hamiltonian" title="Permalink to this heading"></a></h3>
<p>The native states of the protein are the ground states of the cost Hamiltonian. We need it to benchmark our algorithm’s performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ground_energy</span><span class="p">,</span> <span class="n">ground_states_index</span> <span class="o">=</span> <span class="n">get_ground_states_i</span><span class="p">(</span><span class="n">feasible_set</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">)</span> <span class="c1"># get the ground states</span>

<span class="c1"># This function is cheating! It is an extensive search through all solutions to find the one with the lowest energy.</span>
<span class="c1"># But we use it for benchmarking our algorithm on small problem instances.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ground energy: &#39;</span><span class="p">,</span> <span class="n">ground_energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ground energy:  -15.75
</pre></div>
</div>
</div>
</div>
</section>
<section id="we-also-need-a-mixer-hamiltonian-for-our-qaoa">
<h3>We also need a mixer Hamiltonian for our QAOA<a class="headerlink" href="#we-also-need-a-mixer-hamiltonian-for-our-qaoa" title="Permalink to this heading"></a></h3>
<p>Pennylane has a command to get a simple X-mixer:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6555bbe0-4908-4be2-b032-29ea49c2e172">
<span class="eqno">(12)<a class="headerlink" href="#equation-6555bbe0-4908-4be2-b032-29ea49c2e172" title="Permalink to this equation"></a></span>\[\begin{equation}
    H_{\text{mixer}} = \sum_i \sigma_i^x.
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma^x\)</span> is the Pauli operator in the <span class="math notranslate nohighlight">\(x\)</span>-direction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H_mixer</span> <span class="o">=</span> <span class="n">qaoa</span><span class="o">.</span><span class="n">x_mixer</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H_mixer:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">H_mixer</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>H_mixer:
  (1) [X0]
+ (1) [X1]
+ (1) [X2]
+ (1) [X3]
+ (1) [X4]
+ (1) [X5]
+ (1) [X6]
+ (1) [X7]
+ (1) [X8]
+ (1) [X9]
+ (1) [X10]
+ (1) [X11]
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-pennylane-to-build-the-qaoa-circuit">
<h3>Using Pennylane to build the QAOA circuit<a class="headerlink" href="#using-pennylane-to-build-the-qaoa-circuit" title="Permalink to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dev</span> <span class="o">=</span> <span class="n">qml</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;default.qubit&#39;</span><span class="p">,</span> <span class="n">wires</span> <span class="o">=</span> <span class="n">qubits</span><span class="p">)</span>

<span class="c1"># Put the Mixer and Cost Hamiltonians in a layer so that we can repeat it</span>
<span class="k">def</span> <span class="nf">qaoa_layer</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">qaoa</span><span class="o">.</span><span class="n">cost_layer</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">)</span>
    <span class="n">qaoa</span><span class="o">.</span><span class="n">mixer_layer</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">H_mixer</span><span class="p">)</span>
    
<span class="c1"># Then repeat it in a circuit with starting in a super position of all bitstrings</span>
<span class="k">def</span> <span class="nf">circuit</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>     <span class="c1"># Gamma and Beta values can be put together to be an array of parameters</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">:</span>     <span class="c1"># To start in a superposition we place a Hadamard on all qubits</span>
        <span class="n">qml</span><span class="o">.</span><span class="n">Hadamard</span><span class="p">(</span><span class="n">wires</span> <span class="o">=</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">qml</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">qaoa_layer</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Repeats our layer p=len(params[0]) times.</span>

<span class="c1"># If we add a expectation value we get a cost function for average cost of the cost Hamiltonian for given parameters</span>
<span class="nd">@qml</span><span class="o">.</span><span class="n">qnode</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">average_cost</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circuit</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qml</span><span class="o">.</span><span class="n">expval</span><span class="p">(</span><span class="n">H_cost</span><span class="p">)</span>

<span class="c1"># Let&#39;s test it! Only one layer.</span>
<span class="n">zero_parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]])</span> <span class="c1"># Gamma and Beta both set to 0.</span>
<span class="n">half_parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">]])</span>  <span class="c1"># Gamma and Beta both set to 0.5.</span>

<span class="c1">#print(&#39;Average cost with gamma=0 and beta=0:\n&#39;, average_cost(zero_parameters))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average cost with gamma=0.5 and beta=0.5:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">average_cost</span><span class="p">(</span><span class="n">half_parameters</span><span class="p">))</span>

<span class="c1"># Draw our circuit</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qml</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">average_cost</span><span class="p">,</span> <span class="n">expansion_strategy</span> <span class="o">=</span> <span class="s1">&#39;device&#39;</span><span class="p">)(</span><span class="n">zero_parameters</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average cost with gamma=0.5 and beta=0.5:
 1.142734828865597

 0: ──H─╭RZZ(0.00)─╭RZZ(0.00)──RZ(-0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)
 1: ──H─╰RZZ(0.00)─│─────────────────────│──────────│──────────│──────────│──────────│─────────
 2: ──H────────────╰RZZ(0.00)────────────│──────────│──────────│──────────│──────────│─────────
 3: ──H──RZ(-0.00)───────────────────────╰RZZ(0.00)─│──────────│──────────│──────────│─────────
 4: ──H─────────────────────────────────────────────╰RZZ(0.00)─│──────────│──────────│─────────
 5: ──H──RZ(-0.00)─────────────────────────────────────────────╰RZZ(0.00)─│──────────│─────────
 6: ──H──RZ(-0.00)────────────────────────────────────────────────────────╰RZZ(0.00)─│─────────
 7: ──H──RZ(-0.00)───────────────────────────────────────────────────────────────────╰RZZ(0.00)
 8: ──H──RZ(-0.00)─────────────────────────────────────────────────────────────────────────────
 9: ──H──RZ(-0.00)─────────────────────────────────────────────────────────────────────────────
10: ──H──RZ(-0.00)─────────────────────────────────────────────────────────────────────────────
11: ──H──RZ(-0.00)─────────────────────────────────────────────────────────────────────────────

──╭RZZ(0.00)─╭RZZ(-0.00)─╭RZZ(-0.00)─╭RZZ(0.00)──RX(0.00)──────────────────────────────────
──│──────────│───────────│───────────│──────────╭RZZ(0.00)──RZ(-0.00)─╭RZZ(0.00)─╭RZZ(0.00)
──│──────────│───────────│───────────│──────────╰RZZ(0.00)──RZ(-0.00)─│──────────│─────────
──│──────────│───────────│───────────│────────────────────────────────╰RZZ(0.00)─│─────────
──│──────────│───────────│───────────│───────────────────────────────────────────╰RZZ(0.00)
──│──────────│───────────│───────────│─────────────────────────────────────────────────────
──│──────────│───────────│───────────│─────────────────────────────────────────────────────
──│──────────│───────────│───────────│─────────────────────────────────────────────────────
──╰RZZ(0.00)─│───────────│───────────│─────────────────────────────────────────────────────
─────────────╰RZZ(-0.00)─│───────────│─────────────────────────────────────────────────────
─────────────────────────╰RZZ(-0.00)─│─────────────────────────────────────────────────────
─────────────────────────────────────╰RZZ(0.00)────────────────────────────────────────────

────────────────────────────────────────────────────────────────────────────────────────────
──╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(-0.00)─╭RZZ(-0.00)─╭RZZ(-0.00)──RX(0.00)─
──│──────────│──────────│──────────│──────────│───────────│───────────│───────────╭RZZ(0.00)
──│──────────│──────────│──────────│──────────│───────────│───────────│───────────╰RZZ(0.00)
──│──────────│──────────│──────────│──────────│───────────│───────────│─────────────────────
──╰RZZ(0.00)─│──────────│──────────│──────────│───────────│───────────│─────────────────────
─────────────╰RZZ(0.00)─│──────────│──────────│───────────│───────────│─────────────────────
────────────────────────╰RZZ(0.00)─│──────────│───────────│───────────│─────────────────────
───────────────────────────────────╰RZZ(0.00)─│───────────│───────────│─────────────────────
──────────────────────────────────────────────╰RZZ(-0.00)─│───────────│─────────────────────
──────────────────────────────────────────────────────────╰RZZ(-0.00)─│─────────────────────
──────────────────────────────────────────────────────────────────────╰RZZ(-0.00)───────────

───────────────────────────────────────────────────────────────────────────────────────────
───────────────────────────────────────────────────────────────────────────────────────────
──╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(-0.00)─╭RZZ(-0.00)
──│──────────│──────────│──────────│──────────│──────────│──────────│───────────│──────────
──╰RZZ(0.00)─│──────────│──────────│──────────│──────────│──────────│───────────│──────────
─────────────╰RZZ(0.00)─│──────────│──────────│──────────│──────────│───────────│──────────
────────────────────────╰RZZ(0.00)─│──────────│──────────│──────────│───────────│──────────
───────────────────────────────────╰RZZ(0.00)─│──────────│──────────│───────────│──────────
──────────────────────────────────────────────╰RZZ(0.00)─│──────────│───────────│──────────
─────────────────────────────────────────────────────────╰RZZ(0.00)─│───────────│──────────
────────────────────────────────────────────────────────────────────╰RZZ(-0.00)─│──────────
────────────────────────────────────────────────────────────────────────────────╰RZZ(-0.00)

────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
───RX(0.00)─────────────────────────────────────────────────────────────────────────────────────────
──╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)──RX(0.00)─
──╰RZZ(0.00)─│──────────│──────────│──────────│──────────│──────────│──────────│──────────╭RZZ(0.00)
─────────────╰RZZ(0.00)─│──────────│──────────│──────────│──────────│──────────│──────────╰RZZ(0.00)
────────────────────────╰RZZ(0.00)─│──────────│──────────│──────────│──────────│────────────────────
───────────────────────────────────╰RZZ(0.00)─│──────────│──────────│──────────│────────────────────
──────────────────────────────────────────────╰RZZ(0.00)─│──────────│──────────│────────────────────
─────────────────────────────────────────────────────────╰RZZ(0.00)─│──────────│────────────────────
────────────────────────────────────────────────────────────────────╰RZZ(0.00)─│────────────────────
───────────────────────────────────────────────────────────────────────────────╰RZZ(0.00)───────────

────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
───RZ(-0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)──RX(0.00)────────────
─────────────│──────────│──────────│──────────│──────────│──────────│──────────╭RZZ(0.00)─╭RZZ(0.00)
─────────────╰RZZ(0.00)─│──────────│──────────│──────────│──────────│──────────╰RZZ(0.00)─│─────────
────────────────────────╰RZZ(0.00)─│──────────│──────────│──────────│─────────────────────╰RZZ(0.00)
───────────────────────────────────╰RZZ(0.00)─│──────────│──────────│───────────────────────────────
──────────────────────────────────────────────╰RZZ(0.00)─│──────────│───────────────────────────────
─────────────────────────────────────────────────────────╰RZZ(0.00)─│───────────────────────────────
────────────────────────────────────────────────────────────────────╰RZZ(0.00)──────────────────────

────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
──╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)──RX(0.00)─────────────────────────────────────────────
──│──────────│──────────│──────────│──────────╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)
──│──────────│──────────│──────────│──────────╰RZZ(0.00)─│──────────│──────────│──────────│─────────
──╰RZZ(0.00)─│──────────│──────────│─────────────────────╰RZZ(0.00)─│──────────│──────────│─────────
─────────────╰RZZ(0.00)─│──────────│────────────────────────────────╰RZZ(0.00)─│──────────│─────────
────────────────────────╰RZZ(0.00)─│───────────────────────────────────────────╰RZZ(0.00)─│─────────
───────────────────────────────────╰RZZ(0.00)─────────────────────────────────────────────╰RZZ(0.00)

────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
────────────────────────────────────────────────────────────────────────────────────────────────────
───RX(0.00)─────────────────────────────────────────────────────────────────────────────────────────
──╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)──RX(0.00)─────────────────────────────────────────────
──╰RZZ(0.00)─│──────────│──────────│──────────╭RZZ(0.00)─╭RZZ(0.00)─╭RZZ(0.00)──RX(0.00)────────────
─────────────╰RZZ(0.00)─│──────────│──────────╰RZZ(0.00)─│──────────│──────────╭RZZ(0.00)─╭RZZ(0.00)
────────────────────────╰RZZ(0.00)─│─────────────────────╰RZZ(0.00)─│──────────╰RZZ(0.00)─│─────────
───────────────────────────────────╰RZZ(0.00)───────────────────────╰RZZ(0.00)────────────╰RZZ(0.00)

───────────────────────┤ ╭&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───────────────────────┤ ├&lt;𝓗&gt;
───RX(0.00)────────────┤ ├&lt;𝓗&gt;
──╭RZZ(0.00)──RX(0.00)─┤ ├&lt;𝓗&gt;
──╰RZZ(0.00)──RX(0.00)─┤ ╰&lt;𝓗&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="optimisation-of-the-circuit-parameters-with-a-gradient-descent">
<h2>Optimisation of the circuit parameters with a gradient descent<a class="headerlink" href="#optimisation-of-the-circuit-parameters-with-a-gradient-descent" title="Permalink to this heading"></a></h2>
<p>We walk in parameter space to find the best parameters to get a high probability for the low energy states.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define which optimiser we want to use, AdamOptimizer() is another option</span>
<span class="n">optimiser</span> <span class="o">=</span> <span class="n">qml</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">()</span>

<span class="c1"># How many steps are we taking</span>
<span class="n">steps</span> <span class="o">=</span> <span class="mi">20</span> 

<span class="c1"># Naive initial parameters</span>
<span class="n">initial_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]],</span> <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Number of layers in our circuit</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Vectors for saving the information</span>
<span class="n">cost_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
<span class="n">cost_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_cost</span><span class="p">(</span><span class="n">initial_params</span><span class="p">)</span>
<span class="n">params_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">steps</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

<span class="c1"># Loop for performing the optimisation</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">initial_params</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="n">params_vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">cost_</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">step_and_cost</span><span class="p">(</span><span class="n">average_cost</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">cost_vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost_</span>

<span class="c1"># How did we do?</span>
<span class="n">best_params_optimisation</span> <span class="o">=</span> <span class="n">params</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal parameters after gradient descent:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">best_params_optimisation</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Average cost for the best parameters:&#39;</span><span class="p">,</span> <span class="n">average_cost</span><span class="p">(</span><span class="n">best_params_optimisation</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compared to the ground energy: &#39;</span><span class="p">,</span> <span class="n">ground_energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal parameters after gradient descent:
 [[0.58036313 0.20126803]
 [0.40120566 0.48723116]]

Average cost for the best parameters: -1.4518091105793292
Compared to the ground energy:  -15.75
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s plot that</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cost_vector</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Steps&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average cost&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Optimisation of $\gamma$ and $\beta$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_305/2123675139.py:2: MatplotlibDeprecationWarning: The seaborn styles shipped by Matplotlib are deprecated since 3.6, as they no longer correspond to the styles shipped by seaborn. However, they will remain available as &#39;seaborn-v0_8-&lt;style&gt;&#39;. Alternatively, directly use the seaborn API instead.
  plt.style.use(&quot;seaborn&quot;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Optimisation of $\\gamma$ and $\\beta$&#39;)
</pre></div>
</div>
<img alt="../../_images/f7158b5cce14283759c68ef3cc3962b119e2bde62fea36cc86d19862cef651b6.png" src="../../_images/f7158b5cce14283759c68ef3cc3962b119e2bde62fea36cc86d19862cef651b6.png" />
</div>
</div>
<section id="evaluation-of-optimisation-of-cirquit-parameters">
<h3>Evaluation of optimisation of cirquit parameters<a class="headerlink" href="#evaluation-of-optimisation-of-cirquit-parameters" title="Permalink to this heading"></a></h3>
<p>We can see that the average cost of the circuit is lower than for the initial parameters. However, what does that mean for our protein? We want to ensure the probability to find the best fold is as high as possible.</p>
<p>Success probability or Overlap with solution:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9b48ea39-2f75-49f3-a8cf-8982a79ba135">
<span class="eqno">(13)<a class="headerlink" href="#equation-9b48ea39-2f75-49f3-a8cf-8982a79ba135" title="Permalink to this equation"></a></span>\[\begin{equation}
    SP(\gamma, \beta) = |\braket{x_{best}}{\gamma, \beta}|^2
\end{equation}\]</div>
<p>which is the probability of measuring the solution given the parameters <span class="math notranslate nohighlight">\(\gamma, \beta\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A function for obtaining the probability of measuring the different foldings</span>
<span class="c1"># in the end of the circuit given a set of parameters</span>
<span class="nd">@qml</span><span class="o">.</span><span class="n">qnode</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">probability_circuit</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circuit</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qml</span><span class="o">.</span><span class="n">probs</span><span class="p">(</span><span class="n">wires</span> <span class="o">=</span> <span class="n">qubits</span><span class="p">)</span>


<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">best_params_optimisation</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_index</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Success probability:  0.002879248552801237
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot all solutions with a probability over a threshhold (to not over crowd the graph)</span>
<span class="c1"># The color of the graph is the classical energy of the solution/fold.</span>
<span class="c1"># A ground state will have a green label.</span>

<span class="c1"># If the there are no solutions with a probability over the threshhold we don&#39;t get a graph.</span>
<span class="n">plot_probs_with_energy</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">ground_states_index</span><span class="p">,</span> <span class="n">threshhold</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">)</span> <span class="c1"># plot probability over bitstrings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_305/575894199.py:519: MatplotlibDeprecationWarning: Unable to determine Axes to steal space for Colorbar. Using gca(), but will raise in the future. Either provide the *cax* argument to use as the Axes for the Colorbar, provide the *ax* argument to steal space from it, or add *mappable* to an Axes.
  cbar = plt.colorbar(scat) # colorbar on the side
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x550 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/099bbea07ebdae72fbfeb84047b4ce4344cae8ad8c413a248d699a815633a4bd.png" src="../../_images/099bbea07ebdae72fbfeb84047b4ce4344cae8ad8c413a248d699a815633a4bd.png" />
</div>
</div>
<p>Only one or two layers of the circuit will not perform very good.</p>
</section>
</section>
<section id="here-follows-a-different-ways-to-get-a-better-success-probability">
<h2>Here follows a different ways to get a better success probability<a class="headerlink" href="#here-follows-a-different-ways-to-get-a-better-success-probability" title="Permalink to this heading"></a></h2>
<p>You can choose to continue tweeking above code to give better answers or to explore other suggestions for optimisation.</p>
</section>
<section id="changing-to-a-smarter-mixer-hamiltonian">
<h2>Changing to a smarter mixer Hamiltonian<a class="headerlink" href="#changing-to-a-smarter-mixer-hamiltonian" title="Permalink to this heading"></a></h2>
<p>We can put one constraint in the mixer part of the QAOA algorithm.
See Hadfield et al. 2019: https://www.mdpi.com/1999-4893/12/2/34</p>
<p>The XY-mixer smarter mixer that uses the clusters of the positions on the grids deleting one constraint, by keeping the Hamming distance of the clusters.</p>
<div class="amsmath math notranslate nohighlight" id="equation-8f4ff08e-be8f-4a12-a06e-3568db1b3ccb">
<span class="eqno">(14)<a class="headerlink" href="#equation-8f4ff08e-be8f-4a12-a06e-3568db1b3ccb" title="Permalink to this equation"></a></span>\[\begin{equation}
    H_{XY-mixer} = \frac{1}{2} \sum_{i,j \in E(G)} (\sigma^x_i \sigma^x_j + \sigma^y_i \sigma^y_j),
\end{equation}\]</div>
<p>where the sum is over the edges in the graph <span class="math notranslate nohighlight">\(G\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here is documentation https://docs.pennylane.ai/en/stable/code/api/pennylane.qaoa.mixers.xy_mixer.html</span>
<span class="c1"># protein.Dn is the graph you need</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="optimisation-of-the-circuit-parameters-with-grid-search">
<h2>Optimisation of the circuit parameters with grid search<a class="headerlink" href="#optimisation-of-the-circuit-parameters-with-grid-search" title="Permalink to this heading"></a></h2>
<p>Try all the parameters and save the best one. Not a great way to find the best parameters, but if we get them for p=1, then we may interpolate to a good initial guess for higher p.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid search</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">start_gamma</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">stop_gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">num_points_gamma</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># the more points the better answer, but the longer the wait</span>

<span class="n">start_beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">stop_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">num_points_beta</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># the more points the better answer, but the longer the wait</span>

<span class="c1"># Gamma</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span> <span class="n">stop_gamma</span><span class="p">,</span> <span class="n">num_points_gamma</span><span class="p">)</span>
<span class="c1"># Beta</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_beta</span><span class="p">,</span> <span class="n">stop_beta</span><span class="p">,</span> <span class="n">num_points_beta</span><span class="p">)</span>

<span class="n">grid_search_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">grid_search</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span>
					<span class="n">stop_gamma</span><span class="p">,</span>
					<span class="n">num_points_gamma</span><span class="p">,</span>
					<span class="n">start_beta</span><span class="p">,</span>
					<span class="n">stop_beta</span><span class="p">,</span>
					<span class="n">num_points_beta</span><span class="p">,</span>
					<span class="n">average_cost</span><span class="p">,</span>
					<span class="n">above</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
					<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/hannlinn/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/IPython/core/events.py:93: UserWarning: constrained_layout not applied because axes sizes collapsed to zero.  Try making figure larger or axes decorations smaller.
  func(*args, **kwargs)
</pre></div>
</div>
<img alt="../../_images/226ee7e36ffde9f62c8627ab619c04fc950297c58a1b7f808b187c8207908c61.png" src="../../_images/226ee7e36ffde9f62c8627ab619c04fc950297c58a1b7f808b187c8207908c61.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># More plotting, from above</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">get_batch_array</span><span class="p">(</span><span class="n">start_gamma</span><span class="p">,</span>
					<span class="n">stop_gamma</span><span class="p">,</span>
					<span class="n">num_points_gamma</span><span class="p">,</span>
					<span class="n">start_beta</span><span class="p">,</span>
					<span class="n">stop_beta</span><span class="p">,</span>
					<span class="n">num_points_beta</span><span class="p">)</span>
                
<span class="n">plot_grid_search</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
					<span class="n">Y</span><span class="p">,</span>
					<span class="n">Z</span><span class="p">,</span>
					<span class="n">i</span><span class="p">,</span>
					<span class="n">above</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
					<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
					<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2c00a6835002fea7fa51b78574fc31fb995137bbb78e65857ccf6d7ef5c2ee5a.png" src="../../_images/2c00a6835002fea7fa51b78574fc31fb995137bbb78e65857ccf6d7ef5c2ee5a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Is the grid search better?</span>
<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">grid_search_params</span><span class="p">)</span>

<span class="n">plot_probs_with_energy</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">ground_states_index</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of grid search: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_index</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No solutions with a probability over the given threshhold:  0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_305/575894199.py:519: MatplotlibDeprecationWarning: Unable to determine Axes to steal space for Colorbar. Using gca(), but will raise in the future. Either provide the *cax* argument to use as the Axes for the Colorbar, provide the *ax* argument to steal space from it, or add *mappable* to an Axes.
  cbar = plt.colorbar(scat) # colorbar on the side
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Is the grid search better?</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">grid_search_params</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">plot_probs_with_energy</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">ground_states_index</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of grid search: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_index</span><span class="p">]))</span>

<span class="nn">Cell In[2], line 519,</span> in <span class="ni">plot_probs_with_energy</span><span class="nt">(probs, num_qubits, H_cost, ground_states_i, new_fig, save, name, threshhold)</span>
<span class="g g-Whitespace">    </span><span class="mi">517</span> <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>  <span class="c1"># get the color of the sidebar correct</span>
<span class="g g-Whitespace">    </span><span class="mi">518</span> <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span> <span class="c1"># clear plot</span>
<span class="ne">--&gt; </span><span class="mi">519</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span> <span class="c1"># colorbar on the side</span>
<span class="g g-Whitespace">    </span><span class="mi">520</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Classic energy&#39;</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">522</span> <span class="n">norm</span>  <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/pyplot.py:2137,</span> in <span class="ni">colorbar</span><span class="nt">(mappable, cax, ax, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2132</span>     <span class="k">if</span> <span class="n">mappable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2133</span>         <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No mappable was found to use for colorbar &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2134</span>                            <span class="s1">&#39;creation. First define a mappable such as &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2135</span>                            <span class="s1">&#39;an image (with imshow) or a contour set (&#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2136</span>                            <span class="s1">&#39;with contourf).&#39;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2137</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2138</span> <span class="k">return</span> <span class="n">ret</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/figure.py:1310,</span> in <span class="ni">FigureBase.colorbar</span><span class="nt">(self, mappable, cax, ax, use_gridspec, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1306</span> <span class="n">NON_COLORBAR_KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">,</span> <span class="s1">&#39;shrink&#39;</span><span class="p">,</span> <span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;anchor&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1307</span>                      <span class="s1">&#39;panchor&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1308</span> <span class="n">cb_kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NON_COLORBAR_KEYS</span><span class="p">}</span>
<span class="ne">-&gt; </span><span class="mi">1310</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">cbar</span><span class="o">.</span><span class="n">Colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">mappable</span><span class="p">,</span> <span class="o">**</span><span class="n">cb_kw</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1312</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">userax</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1313</span>     <span class="bp">self</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">current_ax</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/_api/deprecation.py:384,</span> in <span class="ni">delete_parameter.&lt;locals&gt;.wrapper</span><span class="nt">(*inner_args, **inner_kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">inner_args</span><span class="p">,</span> <span class="o">**</span><span class="n">inner_kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inner_args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">name_idx</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inner_kwargs</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">382</span>         <span class="c1"># Early return in the simple, non-deprecated case (much faster than</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span>         <span class="c1"># calling bind()).</span>
<span class="ne">--&gt; </span><span class="mi">384</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">inner_args</span><span class="p">,</span> <span class="o">**</span><span class="n">inner_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>     <span class="n">arguments</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">inner_args</span><span class="p">,</span> <span class="o">**</span><span class="n">inner_kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">arguments</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>     <span class="k">if</span> <span class="n">is_varargs</span> <span class="ow">and</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/colorbar.py:402,</span> in <span class="ni">Colorbar.__init__</span><span class="nt">(self, ax, mappable, cmap, norm, alpha, values, boundaries, orientation, ticklocation, extend, spacing, ticks, format, drawedges, filled, extendfrac, extendrect, label, location)</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticklocation</span> <span class="o">=</span> <span class="n">ticklocation</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">402</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reset_locator_formatter_scale</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">ticks</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_locator</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/colorbar.py:1173,</span> in <span class="ni">Colorbar._reset_locator_formatter_scale</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1167</span> <span class="k">def</span> <span class="nf">_reset_locator_formatter_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1168</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1169</span><span class="sd">     Reset the locator et al to defaults.  Any user-hardcoded changes</span>
<span class="g g-Whitespace">   </span><span class="mi">1170</span><span class="sd">     need to be re-entered if this gets called (either at init, or when</span>
<span class="g g-Whitespace">   </span><span class="mi">1171</span><span class="sd">     the mappable normal gets changed: Colorbar.update_normal)</span>
<span class="g g-Whitespace">   </span><span class="mi">1172</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1173</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_process_values</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1174</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_locator</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1175</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_minorlocator</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/colorbar.py:1096,</span> in <span class="ni">Colorbar._process_values</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1093</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1094</span>     <span class="c1"># otherwise make the boundaries from the size of the cmap:</span>
<span class="g g-Whitespace">   </span><span class="mi">1095</span>     <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span>
<span class="ne">-&gt; </span><span class="mi">1096</span>     <span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniform_y</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1097</span> <span class="c1"># add extra boundaries if needed:</span>
<span class="g g-Whitespace">   </span><span class="mi">1098</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extend_lower</span><span class="p">():</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/colorbar.py:1228,</span> in <span class="ni">Colorbar._uniform_y</span><span class="nt">(self, N)</span>
<span class="g g-Whitespace">   </span><span class="mi">1223</span> <span class="k">def</span> <span class="nf">_uniform_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1224</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1225</span><span class="sd">     Return colorbar data coordinates for *N* uniformly</span>
<span class="g g-Whitespace">   </span><span class="mi">1226</span><span class="sd">     spaced boundaries, plus extension lengths if required.</span>
<span class="g g-Whitespace">   </span><span class="mi">1227</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1228</span>     <span class="n">automin</span> <span class="o">=</span> <span class="n">automax</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1229</span>     <span class="n">extendlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extension_lengths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extendfrac</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1230</span>                                                <span class="n">automin</span><span class="p">,</span> <span class="n">automax</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1231</span>                                                <span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1232</span>     <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="ne">ZeroDivisionError</span>: float division by zero
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error in callback &lt;function _draw_all_if_interactive at 0x7f3f50d162a0&gt; (for post_execute):
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/pyplot.py:120,</span> in <span class="ni">_draw_all_if_interactive</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span> <span class="k">def</span> <span class="nf">_draw_all_if_interactive</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span>     <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">120</span>         <span class="n">draw_all</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/_pylab_helpers.py:132,</span> in <span class="ni">Gcf.draw_all</span><span class="nt">(cls, force)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span> <span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_all_fig_managers</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span>     <span class="k">if</span> <span class="n">force</span> <span class="ow">or</span> <span class="n">manager</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">stale</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">132</span>         <span class="n">manager</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/backend_bases.py:2082,</span> in <span class="ni">FigureCanvasBase.draw_idle</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2080</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span>     <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idle_draw_cntx</span><span class="p">():</span>
<span class="ne">-&gt; </span><span class="mi">2082</span>         <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/backends/backend_agg.py:400,</span> in <span class="ni">FigureCanvasAgg.draw</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span> <span class="c1"># Acquire a lock on the shared font cache.</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span> <span class="k">with</span> <span class="n">RendererAgg</span><span class="o">.</span><span class="n">lock</span><span class="p">,</span> \
<span class="g g-Whitespace">    </span><span class="mi">398</span>      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">_wait_cursor_for_draw_cm</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>       <span class="k">else</span> <span class="n">nullcontext</span><span class="p">()):</span>
<span class="ne">--&gt; </span><span class="mi">400</span>     <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="c1"># A GUI class may be need to update a window using this draw, so</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="c1"># don&#39;t forget to call the superclass.</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:95,</span> in <span class="ni">_finalize_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span> <span class="k">def</span> <span class="nf">draw_wrapper</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">95</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>     <span class="k">if</span> <span class="n">renderer</span><span class="o">.</span><span class="n">_rasterizing</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">stop_rasterizing</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:72,</span> in <span class="ni">allow_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/figure.py:3175,</span> in <span class="ni">Figure.draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">   </span><span class="mi">3172</span>         <span class="c1"># ValueError can occur when resizing a window.</span>
<span class="g g-Whitespace">   </span><span class="mi">3174</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3175</span> <span class="n">mimage</span><span class="o">.</span><span class="n">_draw_list_compositing_images</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3176</span>     <span class="n">renderer</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppressComposite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3178</span> <span class="k">for</span> <span class="n">sfig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subfigs</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3179</span>     <span class="n">sfig</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/image.py:131,</span> in <span class="ni">_draw_list_compositing_images</span><span class="nt">(renderer, parent, artists, suppress_composite)</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">131</span>         <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="c1"># Composite any adjacent images together</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:72,</span> in <span class="ni">allow_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axes/_base.py:3064,</span> in <span class="ni">_AxesBase.draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">   </span><span class="mi">3061</span> <span class="k">if</span> <span class="n">artists_rasterized</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3062</span>     <span class="n">_draw_rasterized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">artists_rasterized</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3064</span> <span class="n">mimage</span><span class="o">.</span><span class="n">_draw_list_compositing_images</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3065</span>     <span class="n">renderer</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">suppressComposite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3067</span> <span class="n">renderer</span><span class="o">.</span><span class="n">close_group</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3068</span> <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/image.py:131,</span> in <span class="ni">_draw_list_compositing_images</span><span class="nt">(renderer, parent, artists, suppress_composite)</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">131</span>         <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="c1"># Composite any adjacent images together</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:72,</span> in <span class="ni">allow_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:1376,</span> in <span class="ni">Axis.draw</span><span class="nt">(self, renderer, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1373</span>     <span class="k">return</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span> <span class="n">renderer</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_gid</span><span class="p">())</span>
<span class="ne">-&gt; </span><span class="mi">1376</span> <span class="n">ticks_to_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_ticks</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1377</span> <span class="n">tlb1</span><span class="p">,</span> <span class="n">tlb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ticklabel_bboxes</span><span class="p">(</span><span class="n">ticks_to_draw</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1379</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks_to_draw</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:1262,</span> in <span class="ni">Axis._update_ticks</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1257</span> <span class="k">def</span> <span class="nf">_update_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1258</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1259</span><span class="sd">     Update ticks (position and labels) using the current data interval of</span>
<span class="g g-Whitespace">   </span><span class="mi">1260</span><span class="sd">     the axes.  Return the list of ticks that will be drawn.</span>
<span class="g g-Whitespace">   </span><span class="mi">1261</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1262</span>     <span class="n">major_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_majorticklocs</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1263</span>     <span class="n">major_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_ticks</span><span class="p">(</span><span class="n">major_locs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1264</span>     <span class="n">major_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">major_locs</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:1484,</span> in <span class="ni">Axis.get_majorticklocs</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1482</span> <span class="k">def</span> <span class="nf">get_majorticklocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1483</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return this Axis&#39; major tick locations in data coordinates.&quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1484</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="o">.</span><span class="n">locator</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/ticker.py:2136,</span> in <span class="ni">MaxNLocator.__call__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">2134</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2135</span>     <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_view_interval</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">2136</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick_values</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/ticker.py:2144,</span> in <span class="ni">MaxNLocator.tick_values</span><span class="nt">(self, vmin, vmax)</span>
<span class="g g-Whitespace">   </span><span class="mi">2141</span>     <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">vmax</span>
<span class="g g-Whitespace">   </span><span class="mi">2142</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">mtransforms</span><span class="o">.</span><span class="n">nonsingular</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2143</span>     <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">expander</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">,</span> <span class="n">tiny</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2144</span> <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_ticks</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2146</span> <span class="n">prune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span>
<span class="g g-Whitespace">   </span><span class="mi">2147</span> <span class="k">if</span> <span class="n">prune</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/ticker.py:2083,</span> in <span class="ni">MaxNLocator._raw_ticks</span><span class="nt">(self, vmin, vmax)</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2082</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2083</span>         <span class="n">nbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_tick_space</span><span class="p">(),</span>
<span class="g g-Whitespace">   </span><span class="mi">2084</span>                         <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_n_ticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2085</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2086</span>         <span class="n">nbins</span> <span class="o">=</span> <span class="mi">9</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:2482,</span> in <span class="ni">XAxis.get_tick_space</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">2480</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tick_label_size</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
<span class="g g-Whitespace">   </span><span class="mi">2481</span> <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2482</span>     <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="n">size</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">2483</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2484</span>     <span class="k">return</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span>

<span class="ne">ValueError</span>: cannot convert float NaN to integer
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x550 with 0 Axes&gt;
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/IPython/core/formatters.py:340,</span> in <span class="ni">BaseFormatter.__call__</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">338</span>     <span class="k">pass</span>
<span class="g g-Whitespace">    </span><span class="mi">339</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">340</span>     <span class="k">return</span> <span class="n">printer</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span> <span class="c1"># Finally look for special method names</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span> <span class="n">method</span> <span class="o">=</span> <span class="n">get_real_method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_method</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/IPython/core/pylabtools.py:152,</span> in <span class="ni">print_figure</span><span class="nt">(fig, fmt, bbox_inches, base64, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>     <span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="kn">import</span> <span class="n">FigureCanvasBase</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>     <span class="n">FigureCanvasBase</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">152</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">print_figure</span><span class="p">(</span><span class="n">bytes_io</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bytes_io</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span> <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;svg&#39;</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/backend_bases.py:2342,</span> in <span class="ni">FigureCanvasBase.print_figure</span><span class="nt">(self, filename, dpi, facecolor, edgecolor, orientation, format, bbox_inches, pad_inches, bbox_extra_artists, backend, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2336</span>     <span class="n">renderer</span> <span class="o">=</span> <span class="n">_get_renderer</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2337</span>         <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2338</span>         <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2339</span>             <span class="n">print_method</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2340</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2341</span>     <span class="k">with</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="s2">&quot;_draw_disabled&quot;</span><span class="p">,</span> <span class="n">nullcontext</span><span class="p">)():</span>
<span class="ne">-&gt; </span><span class="mi">2342</span>         <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2344</span> <span class="k">if</span> <span class="n">bbox_inches</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2345</span>     <span class="k">if</span> <span class="n">bbox_inches</span> <span class="o">==</span> <span class="s2">&quot;tight&quot;</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:95,</span> in <span class="ni">_finalize_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span> <span class="k">def</span> <span class="nf">draw_wrapper</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">95</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>     <span class="k">if</span> <span class="n">renderer</span><span class="o">.</span><span class="n">_rasterizing</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">stop_rasterizing</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:72,</span> in <span class="ni">allow_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/figure.py:3175,</span> in <span class="ni">Figure.draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">   </span><span class="mi">3172</span>         <span class="c1"># ValueError can occur when resizing a window.</span>
<span class="g g-Whitespace">   </span><span class="mi">3174</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3175</span> <span class="n">mimage</span><span class="o">.</span><span class="n">_draw_list_compositing_images</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3176</span>     <span class="n">renderer</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppressComposite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3178</span> <span class="k">for</span> <span class="n">sfig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subfigs</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3179</span>     <span class="n">sfig</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/image.py:131,</span> in <span class="ni">_draw_list_compositing_images</span><span class="nt">(renderer, parent, artists, suppress_composite)</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">131</span>         <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="c1"># Composite any adjacent images together</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:72,</span> in <span class="ni">allow_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axes/_base.py:3064,</span> in <span class="ni">_AxesBase.draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">   </span><span class="mi">3061</span> <span class="k">if</span> <span class="n">artists_rasterized</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3062</span>     <span class="n">_draw_rasterized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">artists_rasterized</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3064</span> <span class="n">mimage</span><span class="o">.</span><span class="n">_draw_list_compositing_images</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3065</span>     <span class="n">renderer</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">suppressComposite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3067</span> <span class="n">renderer</span><span class="o">.</span><span class="n">close_group</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3068</span> <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/image.py:131,</span> in <span class="ni">_draw_list_compositing_images</span><span class="nt">(renderer, parent, artists, suppress_composite)</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">131</span>         <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="c1"># Composite any adjacent images together</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/artist.py:72,</span> in <span class="ni">allow_rasterization.&lt;locals&gt;.draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:1376,</span> in <span class="ni">Axis.draw</span><span class="nt">(self, renderer, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1373</span>     <span class="k">return</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span> <span class="n">renderer</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_gid</span><span class="p">())</span>
<span class="ne">-&gt; </span><span class="mi">1376</span> <span class="n">ticks_to_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_ticks</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1377</span> <span class="n">tlb1</span><span class="p">,</span> <span class="n">tlb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ticklabel_bboxes</span><span class="p">(</span><span class="n">ticks_to_draw</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1379</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks_to_draw</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:1262,</span> in <span class="ni">Axis._update_ticks</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1257</span> <span class="k">def</span> <span class="nf">_update_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1258</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1259</span><span class="sd">     Update ticks (position and labels) using the current data interval of</span>
<span class="g g-Whitespace">   </span><span class="mi">1260</span><span class="sd">     the axes.  Return the list of ticks that will be drawn.</span>
<span class="g g-Whitespace">   </span><span class="mi">1261</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1262</span>     <span class="n">major_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_majorticklocs</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1263</span>     <span class="n">major_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_ticks</span><span class="p">(</span><span class="n">major_locs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1264</span>     <span class="n">major_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">major_locs</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:1484,</span> in <span class="ni">Axis.get_majorticklocs</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1482</span> <span class="k">def</span> <span class="nf">get_majorticklocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1483</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return this Axis&#39; major tick locations in data coordinates.&quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1484</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span><span class="o">.</span><span class="n">locator</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/ticker.py:2136,</span> in <span class="ni">MaxNLocator.__call__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">2134</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2135</span>     <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_view_interval</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">2136</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick_values</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/ticker.py:2144,</span> in <span class="ni">MaxNLocator.tick_values</span><span class="nt">(self, vmin, vmax)</span>
<span class="g g-Whitespace">   </span><span class="mi">2141</span>     <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">vmax</span>
<span class="g g-Whitespace">   </span><span class="mi">2142</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">mtransforms</span><span class="o">.</span><span class="n">nonsingular</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2143</span>     <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">expander</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">,</span> <span class="n">tiny</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2144</span> <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_ticks</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2146</span> <span class="n">prune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span>
<span class="g g-Whitespace">   </span><span class="mi">2147</span> <span class="k">if</span> <span class="n">prune</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/ticker.py:2083,</span> in <span class="ni">MaxNLocator._raw_ticks</span><span class="nt">(self, vmin, vmax)</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2082</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2083</span>         <span class="n">nbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_tick_space</span><span class="p">(),</span>
<span class="g g-Whitespace">   </span><span class="mi">2084</span>                         <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_n_ticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2085</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2086</span>         <span class="n">nbins</span> <span class="o">=</span> <span class="mi">9</span>

<span class="nn">File ~/miniconda3/envs/tutorialproteinenv/lib/python3.11/site-packages/matplotlib/axis.py:2482,</span> in <span class="ni">XAxis.get_tick_space</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">2480</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tick_label_size</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
<span class="g g-Whitespace">   </span><span class="mi">2481</span> <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2482</span>     <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="n">size</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">2483</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2484</span>     <span class="k">return</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span>

<span class="ne">ValueError</span>: cannot convert float NaN to integer
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1500x700 with 2 Axes&gt;
</pre></div>
</div>
</div>
</div>
<section id="interpolate-parameters">
<h3>Interpolate parameters<a class="headerlink" href="#interpolate-parameters" title="Permalink to this heading"></a></h3>
<p>For more details see Appendix B part 1. “Interpolation-based strategy” Lukin et al. 2020: https://journals.aps.org/prx/abstract/10.1103/PhysRevX.10.021067</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate parameters to get next parameters to optimise over</span>

<span class="n">interpolated_params</span> <span class="o">=</span> <span class="n">interpolate_params</span><span class="p">(</span><span class="n">grid_search_params</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">only_last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">interpolated_params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of interpolated annealing parameters: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_index</span><span class="p">]))</span>

<span class="c1"># You can also interpolate from an optimisation run.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid search for p=2.</span>
<span class="c1"># Takes a long time so this cell may be skipped.</span>

<span class="c1"># Will build a 4-dimensional vector and go though all values getting the heurustic functions result.</span>
<span class="c1"># Then return the best parameters [0], and the tensor with the values [1].</span>
<span class="n">params_p2</span> <span class="o">=</span> <span class="n">vec_grid_search_p2</span><span class="p">(</span><span class="n">start_gamma</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">stop_gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">num_points_gamma</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="c1"># keep in mind that a value over 10 will take forever</span>
						<span class="n">start_beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">stop_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">num_points_beta</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="c1"># keep in mind that a value over 10 will take forever</span>
						<span class="n">heuristic</span> <span class="o">=</span> <span class="n">average_cost</span><span class="p">,</span>
						<span class="n">vmap</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">params_p2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of grid search p=2: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_index</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate from best parameters for p=2 to p=3.</span>

<span class="n">params_p3</span> <span class="o">=</span> <span class="n">interpolate_params</span><span class="p">(</span><span class="n">params_p2</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">only_last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">params_p3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of grid search p=3: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_index</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="optimisation-of-the-circuit-parameters-with-quantum-annealing-initialisation">
<h2>Optimisation of the circuit parameters with quantum annealing initialisation<a class="headerlink" href="#optimisation-of-the-circuit-parameters-with-quantum-annealing-initialisation" title="Permalink to this heading"></a></h2>
<p>We can warm start the search for the best parameters by taking inspiration from quantum annealing.
Read more here: https://quantum-journal.org/papers/q-2021-07-01-491/</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annealing_params</span> <span class="o">=</span> <span class="n">get_annealing_params</span><span class="p">(</span><span class="n">annealing_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                                        <span class="n">p</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                                        <span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                        <span class="n">cosine</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                        <span class="n">sine</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                        <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                        <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">annealing_params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of annealing parameters: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_i</span><span class="p">]))</span>
<span class="c1">#plot_probs_with_energy(probs, num_qubits, H_cost, ground_states_i) # plot probability over bitstrings</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Is the annealing parameters better better?</span>
<span class="n">plot_probs_with_energy</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">H_cost</span><span class="p">,</span> <span class="n">ground_states_i</span><span class="p">,</span> <span class="n">threshhold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="jax-and-jit">
<h2>JAX and JIT<a class="headerlink" href="#jax-and-jit" title="Permalink to this heading"></a></h2>
<p>Read more here: https://jax.readthedocs.io/en/latest/jax-101/02-jitting.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use JAX and JIT packages to speed up the process. Calls for extensive installations.</span>
<span class="c1"># JIT is just-in-time compilation and will only work with small instances. If the number of qubits is 18 or more then the allocation of memory will complain.</span>
<span class="c1"># JAX work the fastest on a GPU, but still faster using vmap on the CPU.</span>

<span class="c1"># In order to run the just in time compilation and JAX, we need another qnode device.</span>
<span class="c1"># This wrapper function will do the job.</span>
<span class="k">def</span> <span class="nf">jax_average_cost</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Cost function with average cost of the state as metric.</span>
<span class="sd">    Jax version to be used with batches.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#@jit</span>
    <span class="nd">@qml</span><span class="o">.</span><span class="n">qnode</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">interface</span> <span class="o">=</span> <span class="s1">&#39;jax&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_average_cost</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">circuit</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qml</span><span class="o">.</span><span class="n">expval</span><span class="p">(</span><span class="n">H_cost</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_average_cost</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>


<span class="n">params_p2</span> <span class="o">=</span> <span class="n">vec_grid_search_p2</span><span class="p">(</span><span class="n">start_gamma</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">stop_gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">num_points_gamma</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="c1"># keep in mind that a value over 10 will take forever</span>
						<span class="n">start_beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">stop_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">num_points_beta</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
						<span class="n">heuristic</span><span class="o">=</span> <span class="n">jax_average_cost</span><span class="p">,</span>
						<span class="n">vmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">probs</span> <span class="o">=</span> <span class="n">probability_circuit</span><span class="p">(</span><span class="n">params_p2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success probability of grid search p=2: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">[</span><span class="n">ground_states_i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># JAX for p=1.</span>

<span class="n">grid_search_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">grid_search</span><span class="p">(</span><span class="n">start_gamma</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">stop_gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">num_points_gamma</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="c1"># keep in mind that a value over 10 will take forever</span>
						<span class="n">start_beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">stop_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
						<span class="n">num_points_beta</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
						<span class="n">heuristic</span><span class="o">=</span> <span class="n">jax_average_cost</span><span class="p">,</span>
						<span class="n">vmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">above</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_search_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../QF/" class="btn btn-neutral float-left" title="Tutorial - Quantum support vector regression for disability insurance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>